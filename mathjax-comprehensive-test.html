<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathJax æœ€å¼ºç»“åˆ - å…¨å±€å…¨é¢æµ‹è¯•å¥—ä»¶</title>
    
    <!-- MathJax å…¨å±€é…ç½® - æœ€å¼ºé…ç½® -->
    <script>
        window.MathJax = {
            // å…¨å±€é…ç½®
            startup: {
                ready() {
                    console.log('ğŸš€ MathJax å¯åŠ¨å®Œæˆ');
                    MathJax.startup.defaultReady();
                    // å¯åŠ¨åç«‹å³æµ‹è¯•
                    setTimeout(() => {
                        runComprehensiveTests();
                    }, 100);
                }
            },
            
            // è¾“å…¥å¤„ç†å™¨é…ç½®
            tex: {
                // å†…è”æ•°å­¦åˆ†éš”ç¬¦
                inlineMath: [
                    ['$', '$'],
                    ['\\(', '\\)']
                ],
                // æ˜¾ç¤ºæ•°å­¦åˆ†éš”ç¬¦
                displayMath: [
                    ['$$', '$$'],
                    ['\\[', '\\]']
                ],
                // å¯ç”¨æ‰€æœ‰æ‰©å±•åŒ…
                packages: {
                    '[+]': [
                        'base',
                        'ams',
                        'newcommand',
                        'configmacros',
                        'action',
                        'bbox',
                        'boldsymbol',
                        'braket',
                        'cancel',
                        'color',
                        'enclose',
                        'extpfeil',
                        'html',
                        'mathtools',
                        'mhchem',
                        'physics',
                        'textmacros',
                        'unicode',
                        'verb'
                    ]
                },
                // è‡ªå®šä¹‰å®
                macros: {
                    // åŸºç¡€å®
                    RR: "\\mathbb{R}",
                    CC: "\\mathbb{C}",
                    NN: "\\mathbb{N}",
                    ZZ: "\\mathbb{Z}",
                    QQ: "\\mathbb{Q}",
                    
                    // å‘é‡å’ŒçŸ©é˜µ
                    vec: ["\\mathbf{#1}", 1],
                    mat: ["\\mathbf{#1}", 1],
                    
                    // å¾®ç§¯åˆ†
                    dd: "\\mathrm{d}",
                    pp: "\\partial",
                    grad: "\\nabla",
                    
                    // ç‰©ç†å­¦
                    hbar: "\\hslash",
                    ket: ["|#1\\rangle", 1],
                    bra: ["\\langle#1|", 1],
                    braket: ["\\langle#1|#2\\rangle", 2],
                    
                    // è‡ªå®šä¹‰å‡½æ•°
                    sinc: "\\operatorname{sinc}",
                    rect: "\\operatorname{rect}",
                    
                    // ç‰¹æ®Šç¬¦å·
                    implies: "\\Rightarrow",
                    iff: "\\Leftrightarrow"
                },
                // æ ‡ç­¾å’Œå¼•ç”¨
                tags: 'ams',
                tagSide: 'right',
                tagIndent: '0.8em',
                // å¤šè¡Œå…¬å¼
                multlineWidth: '85%',
                // é”™è¯¯å¤„ç†
                formatError: (jax, err) => {
                    console.error('MathJax é”™è¯¯:', err);
                    return jax.formatError(err);
                }
            },
            
            // MathML é…ç½®
            mathml: {
                forceReparse: true
            },
            
            // AsciiMath é…ç½®
            asciimath: {
                delimiters: [['`', '`'], ['am:', ':am']]
            },
            
            // è¾“å‡ºé…ç½®
            chtml: {
                scale: 1,
                minScale: 0.5,
                matchFontHeight: false,
                fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
            },
            
            svg: {
                scale: 1,
                minScale: 0.5,
                fontCache: 'local'
            },
            
            // èœå•é…ç½®
            options: {
                menuOptions: {
                    settings: {
                        assistiveMml: true,
                        collapsible: true,
                        explorer: true
                    }
                },
                renderActions: {
                    addMenu: [0, '', '']
                }
            },
            
            // åŠ è½½å™¨é…ç½®
            loader: {
                load: [
                    '[tex]/ams',
                    '[tex]/newcommand',
                    '[tex]/configmacros',
                    '[tex]/action',
                    '[tex]/bbox',
                    '[tex]/boldsymbol',
                    '[tex]/braket',
                    '[tex]/cancel',
                    '[tex]/color',
                    '[tex]/enclose',
                    '[tex]/extpfeil',
                    '[tex]/html',
                    '[tex]/mathtools',
                    '[tex]/mhchem',
                    '[tex]/physics',
                    '[tex]/textmacros',
                    '[tex]/unicode',
                    '[tex]/verb'
                ]
            }
        };
    </script>
    
    <!-- åŠ è½½ MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 15px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-left: 5px solid;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .test-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .test-section.basic { border-left-color: #ff6b6b; }
        .test-section.advanced { border-left-color: #4ecdc4; }
        .test-section.physics { border-left-color: #45b7d1; }
        .test-section.chemistry { border-left-color: #96ceb4; }
        .test-section.geometry { border-left-color: #feca57; }
        .test-section.interactive { border-left-color: #ff9ff3; }
        
        .test-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 3px solid #007bff;
        }
        
        .test-item h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .math-display {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #e9ecef;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .controls {
            background: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .controls h2 {
            margin-bottom: 20px;
            color: #ecf0f1;
        }
        
        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        button.success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        
        button.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .performance-meter {
            background: #34495e;
            padding: 20px;
            border-radius: 10px;
            color: white;
            margin: 20px 0;
        }
        
        .meter-bar {
            background: #2c3e50;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12, #e74c3c);
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .interactive-demo {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin: 10px 0;
        }
        
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }
        
        .error-log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§® MathJax æœ€å¼ºç»“åˆæµ‹è¯•å¥—ä»¶</h1>
            <p>å…¨å±€é…ç½® â€¢ å…¨é¢åŠŸèƒ½ â€¢ å…¨æ–¹ä½æµ‹è¯•</p>
        </div>
        
        <div class="controls">
            <h2>ğŸ›ï¸ æµ‹è¯•æ§åˆ¶é¢æ¿</h2>
            <div class="control-group">
                <button onclick="runAllTests()">ğŸš€ è¿è¡Œå…¨éƒ¨æµ‹è¯•</button>
                <button onclick="runPerformanceTest()">âš¡ æ€§èƒ½æµ‹è¯•</button>
                <button onclick="testErrorHandling()">ğŸ› é”™è¯¯å¤„ç†æµ‹è¯•</button>
                <button onclick="clearResults()">ğŸ§¹ æ¸…é™¤ç»“æœ</button>
                <button onclick="exportResults()">ğŸ“Š å¯¼å‡ºç»“æœ</button>
            </div>
            
            <div class="control-group">
                <button onclick="toggleRenderer('chtml')" id="chtml-btn" class="success">HTML-CSS æ¸²æŸ“</button>
                <button onclick="toggleRenderer('svg')" id="svg-btn">SVG æ¸²æŸ“</button>
                <button onclick="reprocessMath()">ğŸ”„ é‡æ–°å¤„ç†</button>
                <button onclick="showMathJaxMenu()">âš™ï¸ MathJax èœå•</button>
            </div>
            
            <div id="status-display" class="status info">
                å‡†å¤‡å°±ç»ª - ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•
            </div>
            
            <div class="performance-meter">
                <div>æ¸²æŸ“æ€§èƒ½: <span id="perf-text">å¾…æµ‹è¯•</span></div>
                <div class="meter-bar">
                    <div class="meter-fill" id="perf-bar" style="width: 0%"></div>
                </div>
            </div>
        </div>        

        <div class="test-grid">
            <!-- åŸºç¡€æ•°å­¦æµ‹è¯• -->
            <div class="test-section basic">
                <h2>ğŸ”¢ åŸºç¡€æ•°å­¦æµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>å†…è”æ•°å­¦</h3>
                    <p>è¿™æ˜¯å†…è”æ•°å­¦: $E = mc^2$ å’Œ $\pi \approx 3.14159$</p>
                    <p>æ›´å¤šå†…è”: \(x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}\)</p>
                </div>
                
                <div class="test-item">
                    <h3>æ˜¾ç¤ºæ•°å­¦</h3>
                    <div class="math-display">
                        $$\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}$$
                    </div>
                    <div class="math-display">
                        \[\sum_{n=1}^{\infty} \frac{1}{n^2} = \frac{\pi^2}{6}\]
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>åˆ†æ•°å’Œæ ¹å¼</h3>
                    <div class="math-display">
                        $$\frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ä¸Šä¸‹æ ‡</h3>
                    <div class="math-display">
                        $$x^{2^3} + y_{i,j}^{(k)} = z_{\text{max}}^{\alpha + \beta}$$
                    </div>
                </div>
            </div>
            
            <!-- é«˜çº§æ•°å­¦æµ‹è¯• -->
            <div class="test-section advanced">
                <h2>ğŸ“ é«˜çº§æ•°å­¦æµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>çŸ©é˜µå’Œè¡Œåˆ—å¼</h3>
                    <div class="math-display">
                        $$\begin{pmatrix}
                        a & b & c \\
                        d & e & f \\
                        g & h & i
                        \end{pmatrix} \cdot \begin{pmatrix}
                        x \\ y \\ z
                        \end{pmatrix} = \begin{pmatrix}
                        ax + by + cz \\
                        dx + ey + fz \\
                        gx + hy + iz
                        \end{pmatrix}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å¤šè¡Œå…¬å¼</h3>
                    <div class="math-display">
                        $$\begin{align}
                        f(x) &= x^2 + 2x + 1 \\
                        &= (x + 1)^2 \\
                        &= (x + 1)(x + 1)
                        \end{align}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>æé™å’Œå¯¼æ•°</h3>
                    <div class="math-display">
                        $$\lim_{x \to 0} \frac{\sin x}{x} = 1 \quad \text{å’Œ} \quad \frac{d}{dx}[x^n] = nx^{n-1}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ç§¯åˆ†</h3>
                    <div class="math-display">
                        $$\oint_C \vec{F} \cdot d\vec{r} = \iint_S (\nabla \times \vec{F}) \cdot d\vec{S}$$
                    </div>
                </div>
            </div>
            
            <!-- ç‰©ç†å­¦æµ‹è¯• -->
            <div class="test-section physics">
                <h2>âš›ï¸ ç‰©ç†å­¦æµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>é‡å­åŠ›å­¦</h3>
                    <div class="math-display">
                        $$i\hbar\frac{\partial}{\partial t}|\psi\rangle = \hat{H}|\psi\rangle$$
                    </div>
                    <div class="math-display">
                        $$\langle\psi|\hat{A}|\psi\rangle = \int_{-\infty}^{\infty} \psi^*(x) \hat{A} \psi(x) dx$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ç”µç£å­¦</h3>
                    <div class="math-display">
                        $$\nabla \cdot \vec{E} = \frac{\rho}{\epsilon_0} \quad \nabla \times \vec{B} = \mu_0\vec{J} + \mu_0\epsilon_0\frac{\partial \vec{E}}{\partial t}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ç›¸å¯¹è®º</h3>
                    <div class="math-display">
                        $$ds^2 = -c^2dt^2 + dx^2 + dy^2 + dz^2$$
                    </div>
                    <div class="math-display">
                        $$E^2 = (pc)^2 + (mc^2)^2$$
                    </div>
                </div>
            </div>
            
            <!-- åŒ–å­¦æµ‹è¯• -->
            <div class="test-section chemistry">
                <h2>ğŸ§ª åŒ–å­¦æµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>åŒ–å­¦æ–¹ç¨‹å¼</h3>
                    <div class="math-display">
                        $$\ce{2H2 + O2 -> 2H2O}$$
                    </div>
                    <div class="math-display">
                        $$\ce{CaCO3 + 2HCl -> CaCl2 + H2O + CO2 ^}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å¤æ‚åŒ–å­¦å¼</h3>
                    <div class="math-display">
                        $$\ce{Cr2O7^2- + 14H+ + 6e- -> 2Cr^3+ + 7H2O}$$
                    </div>
                    <div class="math-display">
                        $$\ce{[Cu(NH3)4]^2+ + 4H2O <=> Cu^2+ + 4NH3 + 4H2O}$$
                    </div>
                </div>
            </div>
            
            <!-- å‡ ä½•å­¦æµ‹è¯• -->
            <div class="test-section geometry">
                <h2>ğŸ“ å‡ ä½•å­¦æµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>ä¸‰è§’å‡½æ•°</h3>
                    <div class="math-display">
                        $$\sin^2\theta + \cos^2\theta = 1$$
                    </div>
                    <div class="math-display">
                        $$e^{i\theta} = \cos\theta + i\sin\theta$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å‘é‡è¿ç®—</h3>
                    <div class="math-display">
                        $$\vec{a} \times \vec{b} = |\vec{a}||\vec{b}|\sin\theta \hat{n}$$
                    </div>
                    <div class="math-display">
                        $$\vec{a} \cdot \vec{b} = a_x b_x + a_y b_y + a_z b_z$$
                    </div>
                </div>
            </div>
            
            <!-- äº¤äº’å¼æµ‹è¯• -->
            <div class="test-section interactive">
                <h2>ğŸ® äº¤äº’å¼æµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>å®æ—¶æ•°å­¦è¾“å…¥</h3>
                    <input type="text" id="math-input" placeholder="è¾“å…¥æ•°å­¦å…¬å¼ï¼Œå¦‚: x^2 + y^2 = r^2" 
                           oninput="renderLiveMath(this.value)">
                    <div class="math-display" id="live-math">
                        è¾“å…¥å…¬å¼å°†åœ¨è¿™é‡Œå®æ—¶æ˜¾ç¤º
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å¤šè¡Œå…¬å¼ç¼–è¾‘å™¨</h3>
                    <textarea id="multiline-input" rows="4" placeholder="è¾“å…¥å¤šè¡Œå…¬å¼...
ä¾‹å¦‚:
\begin{align}
x &= a + b \\
y &= c + d
\end{align}" oninput="renderMultilineMath(this.value)"></textarea>
                    <div class="math-display" id="multiline-math">
                        å¤šè¡Œå…¬å¼å°†åœ¨è¿™é‡Œæ˜¾ç¤º
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å…¬å¼åº“å¿«é€Ÿæ’å…¥</h3>
                    <div class="control-group">
                        <button onclick="insertFormula('quadratic')">äºŒæ¬¡å…¬å¼</button>
                        <button onclick="insertFormula('integral')">ç§¯åˆ†å…¬å¼</button>
                        <button onclick="insertFormula('matrix')">çŸ©é˜µ</button>
                        <button onclick="insertFormula('physics')">ç‰©ç†å…¬å¼</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é”™è¯¯æ—¥å¿— -->
        <div class="test-section">
            <h2>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
            <div id="error-log" class="error-log">
                æµ‹è¯•æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </div>
        
        <!-- è‡ªå®šä¹‰å®æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”§ è‡ªå®šä¹‰å®æµ‹è¯•</h2>
            <div class="test-item">
                <h3>é¢„å®šä¹‰å®</h3>
                <div class="math-display">
                    $$\RR, \CC, \NN, \ZZ, \QQ \text{ (æ•°é›†)}$$
                </div>
                <div class="math-display">
                    $$\vec{v}, \mat{A} \text{ (å‘é‡å’ŒçŸ©é˜µ)}$$
                </div>
                <div class="math-display">
                    $$\dd x, \pp f, \grad f \text{ (å¾®ç§¯åˆ†)}$$
                </div>
                <div class="math-display">
                    $$\ket{\psi}, \bra{\phi}, \braket{\phi}{\psi} \text{ (é‡å­åŠ›å­¦)}$$
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let testResults = [];
        let currentRenderer = 'chtml';
        let performanceData = [];
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('error-log');
            const colorMap = {
                'info': '#3498db',
                'success': '#27ae60', 
                'error': '#e74c3c',
                'warning': '#f39c12'
            };
            
            logElement.innerHTML += `<div style="color: ${colorMap[type]};">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(`[MathJax Test] ${message}`);
        }
        
        // çŠ¶æ€æ›´æ–°å‡½æ•°
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status-display');
            statusElement.className = `status ${type}`;
            statusElement.textContent = message;
        }
        
        // æ€§èƒ½æµ‹è¯•å‡½æ•°
        function measurePerformance(testName, testFunction) {
            const startTime = performance.now();
            
            try {
                const result = testFunction();
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                performanceData.push({
                    test: testName,
                    duration: duration,
                    success: true
                });
                
                log(`âœ… ${testName}: ${duration.toFixed(2)}ms`, 'success');
                return { success: true, duration, result };
                
            } catch (error) {
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                performanceData.push({
                    test: testName,
                    duration: duration,
                    success: false,
                    error: error.message
                });
                
                log(`âŒ ${testName}: ${error.message} (${duration.toFixed(2)}ms)`, 'error');
                return { success: false, duration, error };
            }
        }
        
        // ç»¼åˆæµ‹è¯•å‡½æ•°
        function runComprehensiveTests() {
            log('ğŸš€ å¼€å§‹è¿è¡Œç»¼åˆæµ‹è¯•å¥—ä»¶', 'info');
            updateStatus('æ­£åœ¨è¿è¡Œç»¼åˆæµ‹è¯•...', 'info');
            
            const tests = [
                { name: 'MathJax åˆå§‹åŒ–æ£€æŸ¥', func: testMathJaxInit },
                { name: 'åŸºç¡€æ¸²æŸ“æµ‹è¯•', func: testBasicRendering },
                { name: 'é«˜çº§æ•°å­¦æµ‹è¯•', func: testAdvancedMath },
                { name: 'è‡ªå®šä¹‰å®æµ‹è¯•', func: testCustomMacros },
                { name: 'å¤šæ¸²æŸ“å™¨æµ‹è¯•', func: testMultipleRenderers },
                { name: 'åŠ¨æ€å†…å®¹æµ‹è¯•', func: testDynamicContent },
                { name: 'é”™è¯¯å¤„ç†æµ‹è¯•', func: testErrorHandling },
                { name: 'æ€§èƒ½åŸºå‡†æµ‹è¯•', func: testPerformanceBenchmark }
            ];
            
            let passedTests = 0;
            let totalTests = tests.length;
            
            tests.forEach((test, index) => {
                setTimeout(() => {
                    const result = measurePerformance(test.name, test.func);
                    if (result.success) passedTests++;
                    
                    // æ›´æ–°è¿›åº¦
                    const progress = ((index + 1) / totalTests) * 100;
                    updateProgressBar(progress);
                    
                    // æœ€åä¸€ä¸ªæµ‹è¯•å®Œæˆ
                    if (index === totalTests - 1) {
                        const successRate = (passedTests / totalTests) * 100;
                        updateStatus(`æµ‹è¯•å®Œæˆ: ${passedTests}/${totalTests} é€šè¿‡ (${successRate.toFixed(1)}%)`, 
                                   successRate === 100 ? 'success' : 'warning');
                        
                        log(`ğŸ‰ æµ‹è¯•å¥—ä»¶å®Œæˆ: ${passedTests}/${totalTests} é€šè¿‡`, 
                            successRate === 100 ? 'success' : 'warning');
                    }
                }, index * 500); // é”™å¼€æ‰§è¡Œæ—¶é—´
            });
        }
        
        // å…·ä½“æµ‹è¯•å‡½æ•°
        function testMathJaxInit() {
            if (typeof MathJax === 'undefined') {
                throw new Error('MathJax æœªåŠ è½½');
            }
            
            if (!MathJax.startup || !MathJax.startup.document) {
                throw new Error('MathJax æœªæ­£ç¡®åˆå§‹åŒ–');
            }
            
            return 'MathJax åˆå§‹åŒ–æ­£å¸¸';
        }
        
        function testBasicRendering() {
            const testElement = document.createElement('div');
            testElement.innerHTML = '$$E = mc^2$$';
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    const mathElements = testElement.querySelectorAll('.MathJax');
                    document.body.removeChild(testElement);
                    
                    if (mathElements.length > 0) {
                        resolve('åŸºç¡€æ¸²æŸ“æˆåŠŸ');
                    } else {
                        reject(new Error('åŸºç¡€æ¸²æŸ“å¤±è´¥'));
                    }
                }).catch(reject);
            });
        }
        
        function testAdvancedMath() {
            const complexFormulas = [
                '\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}',
                '\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}',
                '\\sum_{n=1}^{\\infty} \\frac{1}{n^2} = \\frac{\\pi^2}{6}'
            ];
            
            const testElement = document.createElement('div');
            testElement.innerHTML = complexFormulas.map(f => `$$${f}$$`).join('');
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    const mathElements = testElement.querySelectorAll('.MathJax');
                    document.body.removeChild(testElement);
                    
                    if (mathElements.length === complexFormulas.length) {
                        resolve('é«˜çº§æ•°å­¦æ¸²æŸ“æˆåŠŸ');
                    } else {
                        reject(new Error('é«˜çº§æ•°å­¦æ¸²æŸ“å¤±è´¥'));
                    }
                }).catch(reject);
            });
        }
        
        function testCustomMacros() {
            const macroTests = [
                '\\RR \\subset \\CC',
                '\\vec{v} = \\begin{pmatrix} x \\\\ y \\end{pmatrix}',
                '\\dd x \\text{ and } \\pp f',
                '\\ket{\\psi} \\text{ and } \\bra{\\phi}'
            ];
            
            const testElement = document.createElement('div');
            testElement.innerHTML = macroTests.map(f => `$$${f}$$`).join('');
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    const mathElements = testElement.querySelectorAll('.MathJax');
                    document.body.removeChild(testElement);
                    
                    if (mathElements.length === macroTests.length) {
                        resolve('è‡ªå®šä¹‰å®æµ‹è¯•æˆåŠŸ');
                    } else {
                        reject(new Error('è‡ªå®šä¹‰å®æµ‹è¯•å¤±è´¥'));
                    }
                }).catch(reject);
            });
        }
        
        function testMultipleRenderers() {
            // è¿™ä¸ªæµ‹è¯•éœ€è¦å®é™…åˆ‡æ¢æ¸²æŸ“å™¨
            return 'å¤šæ¸²æŸ“å™¨æµ‹è¯•éœ€è¦æ‰‹åŠ¨éªŒè¯';
        }
        
        function testDynamicContent() {
            const testElement = document.createElement('div');
            testElement.innerHTML = '$$x^2 + y^2 = r^2$$';
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    // åŠ¨æ€æ›´æ”¹å†…å®¹
                    testElement.innerHTML = '$$a^2 + b^2 = c^2$$';
                    
                    return MathJax.typesetPromise([testElement]);
                }).then(() => {
                    const mathElements = testElement.querySelectorAll('.MathJax');
                    document.body.removeChild(testElement);
                    
                    if (mathElements.length > 0) {
                        resolve('åŠ¨æ€å†…å®¹æµ‹è¯•æˆåŠŸ');
                    } else {
                        reject(new Error('åŠ¨æ€å†…å®¹æµ‹è¯•å¤±è´¥'));
                    }
                }).catch(reject);
            });
        }
        
        function testPerformanceBenchmark() {
            const startTime = performance.now();
            const formulas = [];
            
            // ç”Ÿæˆ100ä¸ªå¤æ‚å…¬å¼
            for (let i = 0; i < 100; i++) {
                formulas.push(`$$\\sum_{n=1}^{${i+1}} \\frac{1}{n^2} = \\frac{\\pi^2}{6}$$`);
            }
            
            const testElement = document.createElement('div');
            testElement.innerHTML = formulas.join('');
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    const endTime = performance.now();
                    const duration = endTime - startTime;
                    document.body.removeChild(testElement);
                    
                    updatePerformanceMeter(duration);
                    resolve(`æ€§èƒ½æµ‹è¯•å®Œæˆ: ${duration.toFixed(2)}ms (100ä¸ªå…¬å¼)`);
                }).catch(reject);
            });
        }
        
        // æ›´æ–°æ€§èƒ½è®¡é‡å™¨
        function updatePerformanceMeter(duration) {
            const perfText = document.getElementById('perf-text');
            const perfBar = document.getElementById('perf-bar');
            
            perfText.textContent = `${duration.toFixed(2)}ms`;
            
            // æ ¹æ®æ€§èƒ½è®¾ç½®é¢œè‰²å’Œå®½åº¦
            let percentage, color;
            if (duration < 100) {
                percentage = 25;
                color = '#27ae60';
            } else if (duration < 500) {
                percentage = 50;
                color = '#f39c12';
            } else if (duration < 1000) {
                percentage = 75;
                color = '#e67e22';
            } else {
                percentage = 100;
                color = '#e74c3c';
            }
            
            perfBar.style.width = percentage + '%';
            perfBar.style.background = color;
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar(percentage) {
            // è¿™é‡Œå¯ä»¥æ·»åŠ è¿›åº¦æ¡æ›´æ–°é€»è¾‘
            console.log(`æµ‹è¯•è¿›åº¦: ${percentage.toFixed(1)}%`);
        }
        
        // å®æ—¶æ•°å­¦æ¸²æŸ“
        function renderLiveMath(input) {
            const outputElement = document.getElementById('live-math');
            
            if (!input.trim()) {
                outputElement.innerHTML = 'è¾“å…¥å…¬å¼å°†åœ¨è¿™é‡Œå®æ—¶æ˜¾ç¤º';
                return;
            }
            
            // è‡ªåŠ¨æ·»åŠ æ•°å­¦åˆ†éš”ç¬¦
            let mathInput = input;
            if (!mathInput.startsWith('$') && !mathInput.startsWith('\\[')) {
                mathInput = `$$${mathInput}$$`;
            }
            
            outputElement.innerHTML = mathInput;
            
            MathJax.typesetPromise([outputElement]).catch(error => {
                outputElement.innerHTML = `<span style="color: red;">æ¸²æŸ“é”™è¯¯: ${error.message}</span>`;
            });
        }
        
        // å¤šè¡Œæ•°å­¦æ¸²æŸ“
        function renderMultilineMath(input) {
            const outputElement = document.getElementById('multiline-math');
            
            if (!input.trim()) {
                outputElement.innerHTML = 'å¤šè¡Œå…¬å¼å°†åœ¨è¿™é‡Œæ˜¾ç¤º';
                return;
            }
            
            outputElement.innerHTML = `$$${input}$$`;
            
            MathJax.typesetPromise([outputElement]).catch(error => {
                outputElement.innerHTML = `<span style="color: red;">æ¸²æŸ“é”™è¯¯: ${error.message}</span>`;
            });
        }
        
        // æ’å…¥é¢„å®šä¹‰å…¬å¼
        function insertFormula(type) {
            const formulas = {
                quadratic: 'x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}',
                integral: '\\int_{a}^{b} f(x) dx = F(b) - F(a)',
                matrix: '\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix} \\begin{pmatrix} x \\\\ y \\end{pmatrix} = \\begin{pmatrix} ax + by \\\\ cx + dy \\end{pmatrix}',
                physics: 'E = mc^2 \\quad \\text{and} \\quad F = ma'
            };
            
            const input = document.getElementById('math-input');
            input.value = formulas[type] || '';
            renderLiveMath(input.value);
        }
        
        // åˆ‡æ¢æ¸²æŸ“å™¨
        function toggleRenderer(renderer) {
            currentRenderer = renderer;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('#controls button[id$="-btn"]').forEach(btn => {
                btn.classList.remove('success');
            });
            document.getElementById(`${renderer}-btn`).classList.add('success');
            
            // è¿™é‡Œåº”è¯¥å®é™…åˆ‡æ¢MathJaxæ¸²æŸ“å™¨
            log(`åˆ‡æ¢åˆ° ${renderer} æ¸²æŸ“å™¨`, 'info');
            updateStatus(`å½“å‰æ¸²æŸ“å™¨: ${renderer}`, 'info');
        }
        
        // é‡æ–°å¤„ç†æ•°å­¦
        function reprocessMath() {
            updateStatus('æ­£åœ¨é‡æ–°å¤„ç†æ•°å­¦å…¬å¼...', 'info');
            
            MathJax.typesetClear();
            MathJax.typesetPromise().then(() => {
                updateStatus('æ•°å­¦å…¬å¼é‡æ–°å¤„ç†å®Œæˆ', 'success');
                log('âœ… æ•°å­¦å…¬å¼é‡æ–°å¤„ç†å®Œæˆ', 'success');
            }).catch(error => {
                updateStatus('é‡æ–°å¤„ç†å¤±è´¥', 'error');
                log(`âŒ é‡æ–°å¤„ç†å¤±è´¥: ${error.message}`, 'error');
            });
        }
        
        // æ˜¾ç¤ºMathJaxèœå•
        function showMathJaxMenu() {
            // è§¦å‘MathJaxä¸Šä¸‹æ–‡èœå•
            const mathElements = document.querySelectorAll('.MathJax');
            if (mathElements.length > 0) {
                // æ¨¡æ‹Ÿå³é”®ç‚¹å‡»ç¬¬ä¸€ä¸ªæ•°å­¦å…ƒç´ 
                const event = new MouseEvent('contextmenu', {
                    bubbles: true,
                    cancelable: true,
                    view: window
                });
                mathElements[0].dispatchEvent(event);
            } else {
                alert('æ²¡æœ‰æ‰¾åˆ°æ•°å­¦å…ƒç´ æ¥æ˜¾ç¤ºèœå•');
            }
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            runComprehensiveTests();
        }
        
        // è¿è¡Œæ€§èƒ½æµ‹è¯•
        function runPerformanceTest() {
            updateStatus('æ­£åœ¨è¿è¡Œæ€§èƒ½æµ‹è¯•...', 'info');
            measurePerformance('æ€§èƒ½åŸºå‡†æµ‹è¯•', testPerformanceBenchmark);
        }
        
        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('error-log').innerHTML = 'æµ‹è¯•æ—¥å¿—å·²æ¸…é™¤...';
            testResults = [];
            performanceData = [];
            updateStatus('ç»“æœå·²æ¸…é™¤', 'info');
            
            // é‡ç½®æ€§èƒ½è®¡é‡å™¨
            document.getElementById('perf-text').textContent = 'å¾…æµ‹è¯•';
            document.getElementById('perf-bar').style.width = '0%';
        }
        
        // å¯¼å‡ºç»“æœ
        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                testResults: testResults,
                performanceData: performanceData,
                mathJaxConfig: window.MathJax
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mathjax-test-results-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('ğŸ“Š æµ‹è¯•ç»“æœå·²å¯¼å‡º', 'success');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ', 'info');
            updateStatus('MathJax æµ‹è¯•å¥—ä»¶å·²å‡†å¤‡å°±ç»ª', 'success');
        });
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°æ¸²æŸ“
        window.addEventListener('resize', function() {
            setTimeout(() => {
                MathJax.typesetPromise().catch(error => {
                    log(`çª—å£è°ƒæ•´åé‡æ–°æ¸²æŸ“å¤±è´¥: ${error.message}`, 'error');
                });
            }, 100);
        });
    </script>
</body>
</html>