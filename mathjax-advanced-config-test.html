<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathJax é«˜çº§é…ç½®ä¸è¾¹ç•Œæµ‹è¯•</title>
    
    <!-- æœ€å¼º MathJax é…ç½® -->
    <script>
        window.MathJax = {
            // å¯åŠ¨é…ç½®
            startup: {
                ready() {
                    console.log('ğŸš€ MathJax é«˜çº§é…ç½®å¯åŠ¨');
                    MathJax.startup.defaultReady();
                    
                    // å¯åŠ¨åç«‹å³è¿è¡Œæµ‹è¯•
                    setTimeout(() => {
                        runAdvancedTests();
                    }, 500);
                },
                // è‡ªå®šä¹‰å¯åŠ¨å…ƒç´ 
                elements: ['.math-content', '.formula-test']
            },
            
            // TeX è¾“å…¥å¤„ç†å™¨ - å®Œæ•´é…ç½®
            tex: {
                // æ‰€æœ‰å¯èƒ½çš„åˆ†éš”ç¬¦
                inlineMath: [
                    ['$', '$'],
                    ['\\(', '\\)'],
                    ['\\$', '\\$']  // è½¬ä¹‰ç¾å…ƒç¬¦å·
                ],
                displayMath: [
                    ['$$', '$$'],
                    ['\\[', '\\]'],
                    ['\\begin{equation}', '\\end{equation}'],
                    ['\\begin{equation*}', '\\end{equation*}'],
                    ['\\begin{align}', '\\end{align}'],
                    ['\\begin{align*}', '\\end{align*}']
                ],
                
                // å¯ç”¨æ‰€æœ‰æ‰©å±•åŒ…
                packages: {
                    '[+]': [
                        'base',           // åŸºç¡€åŒ…
                        'ams',            // AMS æ•°å­¦
                        'newcommand',     // æ–°å‘½ä»¤
                        'configmacros',   // é…ç½®å®
                        'action',         // åŠ¨ä½œ
                        'bbox',           // è¾¹ç•Œæ¡†
                        'boldsymbol',     // ç²—ä½“ç¬¦å·
                        'braket',         // é‡å­åŠ›å­¦ç¬¦å·
                        'cancel',         // åˆ é™¤çº¿
                        'color',          // é¢œè‰²
                        'enclose',        // åŒ…å›´
                        'extpfeil',       // æ‰©å±•ç®­å¤´
                        'html',           // HTML
                        'mathtools',      // æ•°å­¦å·¥å…·
                        'mhchem',         // åŒ–å­¦
                        'physics',        // ç‰©ç†
                        'textmacros',     // æ–‡æœ¬å®
                        'unicode',        // Unicode
                        'verb',           // é€å­—
                        'cases',          // åˆ†æƒ…å†µ
                        'empheq',         // å¼ºè°ƒæ–¹ç¨‹
                        'gensymb',        // é€šç”¨ç¬¦å·
                        'textcomp'        // æ–‡æœ¬ç¬¦å·
                    ]
                },
                
                // è‡ªå®šä¹‰å® - è¶…çº§å…¨é¢
                macros: {
                    // æ•°é›†
                    RR: "\\mathbb{R}",
                    CC: "\\mathbb{C}",
                    NN: "\\mathbb{N}",
                    ZZ: "\\mathbb{Z}",
                    QQ: "\\mathbb{Q}",
                    PP: "\\mathbb{P}",
                    FF: "\\mathbb{F}",
                    
                    // å‘é‡å’ŒçŸ©é˜µ
                    vec: ["\\mathbf{#1}", 1],
                    mat: ["\\mathbf{#1}", 1],
                    tensor: ["\\mathsf{#1}", 1],
                    
                    // å¾®ç§¯åˆ†
                    dd: "\\mathrm{d}",
                    pp: "\\partial",
                    grad: "\\nabla",
                    div: "\\nabla \\cdot",
                    curl: "\\nabla \\times",
                    laplacian: "\\nabla^2",
                    
                    // ç‰©ç†å­¦
                    hbar: "\\hslash",
                    ket: ["|#1\\rangle", 1],
                    bra: ["\\langle#1|", 1],
                    braket: ["\\langle#1|#2\\rangle", 2],
                    ketbra: ["|#1\\rangle\\langle#2|", 2],
                    expectation: ["\\langle#1\\rangle", 1],
                    
                    // æ¦‚ç‡ç»Ÿè®¡
                    Prob: ["\\mathbb{P}\\left(#1\\right)", 1],
                    Expect: ["\\mathbb{E}\\left[#1\\right]", 1],
                    Var: ["\\text{Var}\\left(#1\\right)", 1],
                    Cov: ["\\text{Cov}\\left(#1, #2\\right)", 2],
                    
                    // å‡½æ•°
                    sinc: "\\operatorname{sinc}",
                    rect: "\\operatorname{rect}",
                    sgn: "\\operatorname{sgn}",
                    erf: "\\operatorname{erf}",
                    erfc: "\\operatorname{erfc}",
                    
                    // é€»è¾‘ç¬¦å·
                    implies: "\\Rightarrow",
                    iff: "\\Leftrightarrow",
                    contradiction: "\\rightarrow\\leftarrow",
                    
                    // é›†åˆè®º
                    powerset: ["\\mathcal{P}\\left(#1\\right)", 1],
                    card: ["\\left|#1\\right|", 1],
                    
                    // æ‹“æ‰‘å­¦
                    interior: ["\\text{int}\\left(#1\\right)", 1],
                    closure: ["\\overline{#1}", 1],
                    boundary: ["\\partial #1", 1],
                    
                    // ä»£æ•°
                    Hom: ["\\text{Hom}\\left(#1, #2\\right)", 2],
                    End: ["\\text{End}\\left(#1\\right)", 1],
                    Aut: ["\\text{Aut}\\left(#1\\right)", 1],
                    
                    // è‡ªå®šä¹‰è¿ç®—ç¬¦
                    argmax: "\\operatorname*{arg\\,max}",
                    argmin: "\\operatorname*{arg\\,min}",
                    
                    // ç‰¹æ®Šå‡½æ•°
                    Li: "\\operatorname{Li}",
                    Ei: "\\operatorname{Ei}",
                    Si: "\\operatorname{Si}",
                    Ci: "\\operatorname{Ci}"
                },
                
                // æ ‡ç­¾å’Œå¼•ç”¨
                tags: 'ams',
                tagSide: 'right',
                tagIndent: '0.8em',
                useLabelIds: true,
                
                // å¤šè¡Œå…¬å¼
                multlineWidth: '85%',
                
                // æ•°å­—å¤„ç†
                digits: /^(?:[0-9]+(?:\\{,\\}[0-9]{3})*(?:\\.[0-9]*)?|\\.[0-9]+)/,
                
                // é”™è¯¯å¤„ç†
                formatError: (jax, err) => {
                    console.error('MathJax TeX é”™è¯¯:', err);
                    return `<span style="color: red; font-weight: bold;">æ•°å­¦é”™è¯¯: ${err.message}</span>`;
                },
                
                // è‡ªåŠ¨æ¢è¡Œ
                linebreaks: {
                    automatic: true,
                    width: "container"
                }
            },
            
            // MathML è¾“å…¥å¤„ç†å™¨
            mathml: {
                forceReparse: true,
                parseAs: 'html',
                verify: {
                    checkArity: true,
                    checkAttributes: true,
                    fullErrors: true,
                    fixMmultiscripts: true,
                    fixMtables: true
                }
            },
            
            // AsciiMath è¾“å…¥å¤„ç†å™¨
            asciimath: {
                delimiters: [
                    ['`', '`'],
                    ['am:', ':am'],
                    ['ascii:', ':ascii']
                ],
                fixphi: true,
                displaystyle: true,
                decimalsign: '.'
            },
            
            // CHTML è¾“å‡ºå¤„ç†å™¨
            chtml: {
                scale: 1,
                minScale: 0.5,
                matchFontHeight: false,
                displayAlign: 'center',
                displayIndent: '0',
                fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2',
                adaptiveCSS: true,
                exFactor: 0.5,
                merrorInheritsFontSize: true
            },
            
            // SVG è¾“å‡ºå¤„ç†å™¨
            svg: {
                scale: 1,
                minScale: 0.5,
                displayAlign: 'center',
                displayIndent: '0',
                fontCache: 'local',
                localID: null,
                internalSpeechTitles: true,
                titleID: 0
            },
            
            // èœå•å’Œé€‰é¡¹
            options: {
                menuOptions: {
                    settings: {
                        assistiveMml: true,
                        collapsible: true,
                        explorer: true,
                        inTabOrder: true
                    }
                },
                renderActions: {
                    addMenu: [0, '', ''],
                    checkLoading: [1, '', '']
                },
                skipHtmlTags: [
                    'script', 'noscript', 'style', 'textarea', 'pre',
                    'code', 'annotation', 'annotation-xml'
                ],
                includeHtmlTags: {
                    br: '\\n',
                    wbr: '',
                    '#comment': ''
                },
                processHtmlClass: 'tex2jax_process|mathjax_process',
                ignoreHtmlClass: 'tex2jax_ignore|mathjax_ignore',
                compileError: function (doc, math, err) {
                    console.error('MathJax ç¼–è¯‘é”™è¯¯:', err);
                    doc.compileError(math, err);
                },
                typesetError: function (doc, math, err) {
                    console.error('MathJax æ’ç‰ˆé”™è¯¯:', err);
                    doc.typesetError(math, err);
                }
            },
            
            // åŠ è½½å™¨é…ç½®
            loader: {
                load: [
                    '[tex]/ams',
                    '[tex]/newcommand',
                    '[tex]/configmacros',
                    '[tex]/action',
                    '[tex]/bbox',
                    '[tex]/boldsymbol',
                    '[tex]/braket',
                    '[tex]/cancel',
                    '[tex]/color',
                    '[tex]/enclose',
                    '[tex]/extpfeil',
                    '[tex]/html',
                    '[tex]/mathtools',
                    '[tex]/mhchem',
                    '[tex]/physics',
                    '[tex]/textmacros',
                    '[tex]/unicode',
                    '[tex]/verb'
                ],
                paths: {
                    mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5'
                },
                require: function (url) {
                    console.log('MathJax åŠ è½½:', url);
                },
                failed: function (err) {
                    console.error('MathJax åŠ è½½å¤±è´¥:', err);
                }
            }
        };
    </script>
    
    <!-- åŠ è½½ MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50, #3498db, #9b59b6, #e74c3c);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
        }
        
        .header h1 {
            font-size: 3em;
            background: linear-gradient(45deg, #3498db, #9b59b6, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.95);
            margin-bottom: 30px;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }
        
        .test-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
        }
        
        .test-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.2);
        }
        
        .test-item h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .math-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: border-color 0.3s ease;
        }
        
        .math-display:hover {
            border-color: #3498db;
        }
        
        .controls {
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(15px);
        }
        
        .controls h2 {
            margin-bottom: 25px;
            color: #ecf0f1;
        }
        
        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }
        
        button.success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        
        button.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        button.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        .status-panel {
            background: rgba(52, 73, 94, 0.95);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(15px);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .status-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .status-value {
            font-size: 2em;
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 5px;
        }
        
        .status-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .log-panel {
            background: rgba(44, 62, 80, 0.95);
            color: #ecf0f1;
            padding: 25px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            backdrop-filter: blur(15px);
        }
        
        .error-highlight {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        .success-highlight {
            color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        .warning-highlight {
            color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¬ MathJax é«˜çº§é…ç½®ä¸è¾¹ç•Œæµ‹è¯•</h1>
            <p>æµ‹è¯•æœ€å¤æ‚çš„æ•°å­¦å…¬å¼ã€è¾¹ç•Œæƒ…å†µå’Œé«˜çº§é…ç½®</p>
        </div>
        
        <div class="controls">
            <h2>ğŸ›ï¸ é«˜çº§æµ‹è¯•æ§åˆ¶</h2>
            <div class="control-group">
                <button onclick="runAdvancedTests()" class="success">ğŸš€ è¿è¡Œé«˜çº§æµ‹è¯•</button>
                <button onclick="runBoundaryTests()" class="warning">âš ï¸ è¾¹ç•Œæµ‹è¯•</button>
                <button onclick="runStressTests()" class="danger">ğŸ’¥ å‹åŠ›æµ‹è¯•</button>
                <button onclick="runConfigTests()">âš™ï¸ é…ç½®æµ‹è¯•</button>
                <button onclick="clearAllTests()">ğŸ§¹ æ¸…é™¤æ‰€æœ‰</button>
            </div>
            
            <div class="control-group">
                <button onclick="testCustomMacros()">ğŸ”§ è‡ªå®šä¹‰å®æµ‹è¯•</button>
                <button onclick="testExtensions()">ğŸ§© æ‰©å±•æµ‹è¯•</button>
                <button onclick="testErrorHandling()">ğŸ› é”™è¯¯å¤„ç†</button>
                <button onclick="testAccessibility()">â™¿ å¯è®¿é—®æ€§</button>
            </div>
        </div>
        
        <div class="status-panel">
            <h2>ğŸ“Š æµ‹è¯•çŠ¶æ€</h2>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-value" id="tests-passed">0</div>
                    <div class="status-label">æµ‹è¯•é€šè¿‡</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="tests-failed">0</div>
                    <div class="status-label">æµ‹è¯•å¤±è´¥</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="render-time">0ms</div>
                    <div class="status-label">æ¸²æŸ“æ—¶é—´</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="memory-usage">0MB</div>
                    <div class="status-label">å†…å­˜ä½¿ç”¨</div>
                </div>
            </div>
        </div>
        
        <!-- è¶…å¤æ‚æ•°å­¦å…¬å¼æµ‹è¯• -->
        <div class="test-section math-content">
            <h2>ğŸ§® è¶…å¤æ‚æ•°å­¦å…¬å¼æµ‹è¯•</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h3>é‡å­åœºè®º</h3>
                    <div class="math-display">
                        $$\mathcal{L} = \bar{\psi}(i\gamma^\mu D_\mu - m)\psi - \frac{1}{4}F_{\mu\nu}F^{\mu\nu}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å¹¿ä¹‰ç›¸å¯¹è®º</h3>
                    <div class="math-display">
                        $$G_{\mu\nu} = R_{\mu\nu} - \frac{1}{2}Rg_{\mu\nu} = \frac{8\pi G}{c^4}T_{\mu\nu}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å¤åˆ†æ</h3>
                    <div class="math-display">
                        $$\oint_C f(z)dz = 2\pi i \sum_{k} \text{Res}(f, z_k)$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>æ‹“æ‰‘å­¦</h3>
                    <div class="math-display">
                        $$\pi_n(S^m) = \begin{cases}
                        \ZZ & \text{if } n = m \\
                        0 & \text{if } n < m \\
                        \text{complicated} & \text{if } n > m
                        \end{cases}$$
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è‡ªå®šä¹‰å®æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”§ è‡ªå®šä¹‰å®æµ‹è¯•</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h3>æ•°é›†å®</h3>
                    <div class="math-display">
                        $$\RR \subset \CC, \quad \NN \subset \ZZ \subset \QQ \subset \RR$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ç‰©ç†å®</h3>
                    <div class="math-display">
                        $$\braket{\psi}{\phi} = \int \psi^*(x) \phi(x) dx$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>æ¦‚ç‡å®</h3>
                    <div class="math-display">
                        $$\Prob{X > x} = \Expect{I_{X > x}} = \int_x^\infty f(t) dt$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å¾®ç§¯åˆ†å®</h3>
                    <div class="math-display">
                        $$\grad f = \pp f / \pp x \vec{i} + \pp f / \pp y \vec{j} + \pp f / \pp z \vec{k}$$
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è¾¹ç•Œæƒ…å†µæµ‹è¯• -->
        <div class="test-section">
            <h2>âš ï¸ è¾¹ç•Œæƒ…å†µæµ‹è¯•</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h3>åµŒå¥—åˆ†æ•°</h3>
                    <div class="math-display">
                        $$\frac{1}{1+\frac{1}{1+\frac{1}{1+\frac{1}{1+\frac{1}{1+\cdots}}}}}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å·¨å¤§çŸ©é˜µ</h3>
                    <div class="math-display">
                        $$\begin{pmatrix}
                        a_{11} & a_{12} & a_{13} & a_{14} & a_{15} \\
                        a_{21} & a_{22} & a_{23} & a_{24} & a_{25} \\
                        a_{31} & a_{32} & a_{33} & a_{34} & a_{35} \\
                        a_{41} & a_{42} & a_{43} & a_{44} & a_{45} \\
                        a_{51} & a_{52} & a_{53} & a_{54} & a_{55}
                        \end{pmatrix}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>è¶…é•¿æ±‚å’Œ</h3>
                    <div class="math-display">
                        $$\sum_{n_1=1}^{\infty}\sum_{n_2=1}^{\infty}\sum_{n_3=1}^{\infty}\sum_{n_4=1}^{\infty} \frac{1}{n_1^2 n_2^2 n_3^2 n_4^2}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>å¤æ‚ç§¯åˆ†</h3>
                    <div class="math-display">
                        $$\int_0^{2\pi} \int_0^{\pi} \int_0^R \int_0^{2\pi} r^2 \sin\theta \, dr \, d\phi \, d\theta \, d\psi$$
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ‰©å±•åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ§© æ‰©å±•åŠŸèƒ½æµ‹è¯•</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h3>åŒ–å­¦æ–¹ç¨‹å¼ (mhchem)</h3>
                    <div class="math-display">
                        $$\ce{Cr2O7^2- + 14H+ + 6e- -> 2Cr^3+ + 7H2O}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>é¢œè‰²å’Œæ ·å¼</h3>
                    <div class="math-display">
                        $$\color{red}{x^2} + \color{blue}{y^2} = \color{green}{r^2}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>åˆ é™¤çº¿ (cancel)</h3>
                    <div class="math-display">
                        $$\frac{\cancel{x^2} + 2x + 1}{\cancel{x^2} - 1} = \frac{2x + 1}{x - 1}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>è¾¹ç•Œæ¡† (bbox)</h3>
                    <div class="math-display">
                        $$\bbox[yellow,5px]{E = mc^2}$$
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é”™è¯¯å¤„ç†æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ› é”™è¯¯å¤„ç†æµ‹è¯•</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h3>è¯­æ³•é”™è¯¯</h3>
                    <div class="math-display">
                        $$\frac{1}{2 + \sqrt{$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>æœªå®šä¹‰å‘½ä»¤</h3>
                    <div class="math-display">
                        $$\unknowncommand{x}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>æ‹¬å·ä¸åŒ¹é…</h3>
                    <div class="math-display">
                        $$\left( \frac{1}{2} \right]$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>æ— æ•ˆå‚æ•°</h3>
                    <div class="math-display">
                        $$\frac{}{}$$
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ€§èƒ½æµ‹è¯•åŒºåŸŸ -->
        <div class="test-section">
            <h2>âš¡ æ€§èƒ½æµ‹è¯•åŒºåŸŸ</h2>
            <div id="performance-test-area" class="test-grid">
                <!-- åŠ¨æ€ç”Ÿæˆçš„æ€§èƒ½æµ‹è¯•å†…å®¹ -->
            </div>
        </div>
        
        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="log-panel" id="test-log">
            <h3>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h3>
            <div id="log-content">
                é«˜çº§é…ç½®æµ‹è¯•æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€æµ‹è¯•çŠ¶æ€
        let testStats = {
            passed: 0,
            failed: 0,
            totalRenderTime: 0,
            memoryUsage: 0
        };
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logContent = document.getElementById('log-content');
            
            const colorClass = {
                'info': '',
                'success': 'success-highlight',
                'error': 'error-highlight',
                'warning': 'warning-highlight'
            }[type] || '';
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="${colorClass}">[${timestamp}] ${message}</span>`;
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
            
            console.log(`[Advanced Test] ${message}`);
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStats() {
            document.getElementById('tests-passed').textContent = testStats.passed;
            document.getElementById('tests-failed').textContent = testStats.failed;
            document.getElementById('render-time').textContent = testStats.totalRenderTime.toFixed(2) + 'ms';
            
            if (performance.memory) {
                testStats.memoryUsage = performance.memory.usedJSHeapSize / 1024 / 1024;
                document.getElementById('memory-usage').textContent = testStats.memoryUsage.toFixed(2) + 'MB';
            }
        }
        
        // æµ‹è¯•å•ä¸ªæ•°å­¦å…¬å¼
        async function testFormula(element, description) {
            const startTime = performance.now();
            
            try {
                await MathJax.typesetPromise([element]);
                const endTime = performance.now();
                const renderTime = endTime - startTime;
                
                testStats.passed++;
                testStats.totalRenderTime += renderTime;
                
                log(`âœ… ${description}: ${renderTime.toFixed(2)}ms`, 'success');
                return true;
                
            } catch (error) {
                testStats.failed++;
                log(`âŒ ${description}: ${error.message}`, 'error');
                return false;
            }
        }
        
        // è¿è¡Œé«˜çº§æµ‹è¯•
        async function runAdvancedTests() {
            log('ğŸš€ å¼€å§‹è¿è¡Œé«˜çº§æµ‹è¯•å¥—ä»¶', 'info');
            
            // é‡ç½®ç»Ÿè®¡
            testStats = { passed: 0, failed: 0, totalRenderTime: 0, memoryUsage: 0 };
            
            // è·å–æ‰€æœ‰æ•°å­¦æ˜¾ç¤ºå…ƒç´ 
            const mathElements = document.querySelectorAll('.math-display');
            
            for (let i = 0; i < mathElements.length; i++) {
                const element = mathElements[i];
                const description = `å…¬å¼ ${i + 1}`;
                
                await testFormula(element, description);
                updateStats();
                
                // çŸ­æš‚å»¶è¿Ÿé¿å…é˜»å¡
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            log(`ğŸ‰ é«˜çº§æµ‹è¯•å®Œæˆ: ${testStats.passed} é€šè¿‡, ${testStats.failed} å¤±è´¥`, 
                testStats.failed === 0 ? 'success' : 'warning');
        }
        
        // è¿è¡Œè¾¹ç•Œæµ‹è¯•
        async function runBoundaryTests() {
            log('âš ï¸ å¼€å§‹è¾¹ç•Œæƒ…å†µæµ‹è¯•', 'warning');
            
            const boundaryTests = [
                {
                    formula: '$$\\frac{1}{1+\\frac{1}{1+\\frac{1}{1+\\frac{1}{1+\\frac{1}{1+\\frac{1}{1+\\frac{1}{1+\\frac{1}{1+\\frac{1}{1+\\frac{1}{1+\\cdots}}}}}}}}}}$$',
                    description: 'æ·±åº¦åµŒå¥—åˆ†æ•°'
                },
                {
                    formula: '$$\\prod_{p \\text{ prime}}^{\\infty} \\left(1 - p^{-s}\\right)^{-1} = \\sum_{n=1}^{\\infty} n^{-s} = \\zeta(s)$$',
                    description: 'æ¬§æ‹‰ä¹˜ç§¯å…¬å¼'
                },
                {
                    formula: '$$\\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} e^{-\\frac{x^2+y^2+z^2}{2\\sigma^2}} \\frac{1}{(2\\pi\\sigma^2)^{3/2}} dx dy dz = 1$$',
                    description: 'ä¸‰ç»´é«˜æ–¯ç§¯åˆ†'
                }
            ];
            
            for (const test of boundaryTests) {
                const testDiv = document.createElement('div');
                testDiv.innerHTML = test.formula;
                document.body.appendChild(testDiv);
                
                await testFormula(testDiv, test.description);
                document.body.removeChild(testDiv);
                
                updateStats();
            }
            
            log('âš ï¸ è¾¹ç•Œæµ‹è¯•å®Œæˆ', 'warning');
        }
        
        // è¿è¡Œå‹åŠ›æµ‹è¯•
        async function runStressTests() {
            log('ğŸ’¥ å¼€å§‹å‹åŠ›æµ‹è¯•', 'error');
            
            const performanceArea = document.getElementById('performance-test-area');
            performanceArea.innerHTML = '';
            
            // ç”Ÿæˆå¤§é‡å¤æ‚å…¬å¼
            const complexFormulas = [];
            for (let i = 0; i < 50; i++) {
                complexFormulas.push(`
                    <div class="test-item">
                        <h4>å‹åŠ›æµ‹è¯• ${i + 1}</h4>
                        <div class="math-display">
                            $$\\sum_{n=1}^{${i + 10}} \\frac{(-1)^n}{n^${i % 5 + 1}} = \\eta(${i % 5 + 1})$$
                        </div>
                    </div>
                `);
            }
            
            performanceArea.innerHTML = complexFormulas.join('');
            
            const startTime = performance.now();
            await MathJax.typesetPromise([performanceArea]);
            const endTime = performance.now();
            
            const totalTime = endTime - startTime;
            testStats.totalRenderTime += totalTime;
            
            log(`ğŸ’¥ å‹åŠ›æµ‹è¯•å®Œæˆ: 50ä¸ªå¤æ‚å…¬å¼ç”¨æ—¶ ${totalTime.toFixed(2)}ms`, 'error');
            updateStats();
        }
        
        // æµ‹è¯•é…ç½®
        function runConfigTests() {
            log('âš™ï¸ å¼€å§‹é…ç½®æµ‹è¯•', 'info');
            
            // æ£€æŸ¥ MathJax é…ç½®
            const config = window.MathJax;
            
            if (config.tex && config.tex.macros) {
                log(`âœ… è‡ªå®šä¹‰å®æ•°é‡: ${Object.keys(config.tex.macros).length}`, 'success');
                testStats.passed++;
            } else {
                log('âŒ è‡ªå®šä¹‰å®é…ç½®å¤±è´¥', 'error');
                testStats.failed++;
            }
            
            if (config.tex && config.tex.packages) {
                const packages = config.tex.packages['[+]'] || [];
                log(`âœ… åŠ è½½çš„æ‰©å±•åŒ…: ${packages.length}`, 'success');
                testStats.passed++;
            } else {
                log('âŒ æ‰©å±•åŒ…é…ç½®å¤±è´¥', 'error');
                testStats.failed++;
            }
            
            // æµ‹è¯•æ¸²æŸ“å™¨
            if (config.chtml) {
                log('âœ… CHTML æ¸²æŸ“å™¨é…ç½®æ­£å¸¸', 'success');
                testStats.passed++;
            } else {
                log('âŒ CHTML æ¸²æŸ“å™¨é…ç½®å¤±è´¥', 'error');
                testStats.failed++;
            }
            
            updateStats();
            log('âš™ï¸ é…ç½®æµ‹è¯•å®Œæˆ', 'info');
        }
        
        // æµ‹è¯•è‡ªå®šä¹‰å®
        async function testCustomMacros() {
            log('ğŸ”§ å¼€å§‹è‡ªå®šä¹‰å®æµ‹è¯•', 'info');
            
            const macroTests = [
                { formula: '$$\\RR \\subset \\CC$$', name: 'æ•°é›†å®' },
                { formula: '$$\\vec{v} = \\begin{pmatrix} x \\\\ y \\end{pmatrix}$$', name: 'å‘é‡å®' },
                { formula: '$$\\braket{\\psi}{\\phi}$$', name: 'é‡å­åŠ›å­¦å®' },
                { formula: '$$\\Prob{X > 0} = \\Expect{I_{X > 0}}$$', name: 'æ¦‚ç‡å®' },
                { formula: '$$\\grad f = \\nabla f$$', name: 'å¾®ç§¯åˆ†å®' }
            ];
            
            for (const test of macroTests) {
                const testDiv = document.createElement('div');
                testDiv.innerHTML = test.formula;
                document.body.appendChild(testDiv);
                
                await testFormula(testDiv, test.name);
                document.body.removeChild(testDiv);
            }
            
            updateStats();
            log('ğŸ”§ è‡ªå®šä¹‰å®æµ‹è¯•å®Œæˆ', 'info');
        }
        
        // æµ‹è¯•æ‰©å±•åŠŸèƒ½
        async function testExtensions() {
            log('ğŸ§© å¼€å§‹æ‰©å±•åŠŸèƒ½æµ‹è¯•', 'info');
            
            const extensionTests = [
                { formula: '$$\\ce{H2SO4 + 2NaOH -> Na2SO4 + 2H2O}$$', name: 'mhchem åŒ–å­¦' },
                { formula: '$$\\color{red}{x} + \\color{blue}{y} = \\color{green}{z}$$', name: 'color é¢œè‰²' },
                { formula: '$$\\cancel{x^2} + 2x + 1$$', name: 'cancel åˆ é™¤çº¿' },
                { formula: '$$\\bbox[yellow,5px]{E = mc^2}$$', name: 'bbox è¾¹ç•Œæ¡†' },
                { formula: '$$\\ket{\\psi} \\in \\mathcal{H}$$', name: 'braket é‡å­ç¬¦å·' }
            ];
            
            for (const test of extensionTests) {
                const testDiv = document.createElement('div');
                testDiv.innerHTML = test.formula;
                document.body.appendChild(testDiv);
                
                await testFormula(testDiv, test.name);
                document.body.removeChild(testDiv);
            }
            
            updateStats();
            log('ğŸ§© æ‰©å±•åŠŸèƒ½æµ‹è¯•å®Œæˆ', 'info');
        }
        
        // æµ‹è¯•é”™è¯¯å¤„ç†
        async function testErrorHandling() {
            log('ğŸ› å¼€å§‹é”™è¯¯å¤„ç†æµ‹è¯•', 'warning');
            
            const errorTests = [
                { formula: '$$\\frac{1}{2 + \\sqrt{$$', name: 'è¯­æ³•é”™è¯¯' },
                { formula: '$$\\unknowncommand{x}$$', name: 'æœªçŸ¥å‘½ä»¤' },
                { formula: '$$\\left( \\frac{1}{2} \\right]$$', name: 'æ‹¬å·ä¸åŒ¹é…' },
                { formula: '$$\\frac{}{}$$', name: 'ç©ºå‚æ•°' }
            ];
            
            for (const test of errorTests) {
                const testDiv = document.createElement('div');
                testDiv.innerHTML = test.formula;
                document.body.appendChild(testDiv);
                
                try {
                    await MathJax.typesetPromise([testDiv]);
                    log(`âš ï¸ ${test.name}: åº”è¯¥å¤±è´¥ä½†æˆåŠŸäº†`, 'warning');
                } catch (error) {
                    log(`âœ… ${test.name}: æ­£ç¡®æ•è·é”™è¯¯ - ${error.message}`, 'success');
                    testStats.passed++;
                }
                
                document.body.removeChild(testDiv);
            }
            
            updateStats();
            log('ğŸ› é”™è¯¯å¤„ç†æµ‹è¯•å®Œæˆ', 'warning');
        }
        
        // æµ‹è¯•å¯è®¿é—®æ€§
        async function testAccessibility() {
            log('â™¿ å¼€å§‹å¯è®¿é—®æ€§æµ‹è¯•', 'info');
            
            const testDiv = document.createElement('div');
            testDiv.innerHTML = '$$\\frac{a}{b} + \\sqrt{c}$$';
            document.body.appendChild(testDiv);
            
            await MathJax.typesetPromise([testDiv]);
            
            // æ£€æŸ¥å¯è®¿é—®æ€§å±æ€§
            const mathElements = testDiv.querySelectorAll('[role="math"]');
            if (mathElements.length > 0) {
                log('âœ… æ•°å­¦å…ƒç´ å…·æœ‰æ­£ç¡®çš„ role å±æ€§', 'success');
                testStats.passed++;
            } else {
                log('âŒ ç¼ºå°‘å¯è®¿é—®æ€§å±æ€§', 'error');
                testStats.failed++;
            }
            
            // æ£€æŸ¥ aria-label
            const ariaElements = testDiv.querySelectorAll('[aria-label]');
            if (ariaElements.length > 0) {
                log('âœ… æ‰¾åˆ° aria-label å±æ€§', 'success');
                testStats.passed++;
            } else {
                log('âš ï¸ æœªæ‰¾åˆ° aria-label å±æ€§', 'warning');
            }
            
            document.body.removeChild(testDiv);
            updateStats();
            log('â™¿ å¯è®¿é—®æ€§æµ‹è¯•å®Œæˆ', 'info');
        }
        
        // æ¸…é™¤æ‰€æœ‰æµ‹è¯•
        function clearAllTests() {
            document.getElementById('log-content').innerHTML = 'é«˜çº§é…ç½®æµ‹è¯•æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
            document.getElementById('performance-test-area').innerHTML = '';
            
            testStats = { passed: 0, failed: 0, totalRenderTime: 0, memoryUsage: 0 };
            updateStats();
            
            log('ğŸ§¹ æ‰€æœ‰æµ‹è¯•å·²æ¸…é™¤', 'info');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“„ MathJax é«˜çº§é…ç½®æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'info');
            updateStats();
        });
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°æ¸²æŸ“
        window.addEventListener('resize', function() {
            setTimeout(() => {
                MathJax.typesetPromise().catch(error => {
                    log(`çª—å£è°ƒæ•´åé‡æ–°æ¸²æŸ“å¤±è´¥: ${error.message}`, 'error');
                });
            }, 100);
        });
    </script>
</body>
</html>