<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£å¼¦ç§¯åˆ†æ¨å¯¼å‡ ä½•å› å­2çš„æ·±åº¦åˆ†æ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0c0c2e, #1a0033, #0c0c2e);
            font-family: 'Arial', sans-serif;
            color: #ffffff;
            overflow: hidden;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        .panel {
            position: absolute;
            background: rgba(10, 20, 40, 0.95);
            border: 2px solid;
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.1);
            z-index: 100;
        }
        
        #analysis-panel {
            top: 20px;
            left: 20px;
            width: 420px;
            border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }
        
        #comparison-panel {
            top: 20px;
            right: 20px;
            width: 380px;
            border-color: #ff6b35;
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.3);
        }
        
        #visualization-controls {
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            border-color: #ff00ff;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 10px currentColor;
        }
        
        .analysis-title { color: #00ffff; }
        .comparison-title { color: #ff6b35; }
        .controls-title { color: #ff00ff; }
        
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .physics-section { border-left-color: #00ff00; }
        .math-section { border-left-color: #ffff00; }
        .insight-section { border-left-color: #ff00ff; }
        .comparison-section { border-left-color: #ff6b35; }
        
        .section-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffffff;
        }
        
        .math-formula {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 6px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .highlight {
            color: #ffff00;
            font-weight: bold;
            text-shadow: 0 0 8px #ffff00;
        }
        
        .success { color: #00ff00; text-shadow: 0 0 8px #00ff00; }
        .warning { color: #ff6b35; text-shadow: 0 0 8px #ff6b35; }
        .critical { color: #ff0000; text-shadow: 0 0 8px #ff0000; }
        
        button {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            border: none;
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin: 0 5px;
            font-size: 12px;
        }
        
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.6);
        }
        
        button.active {
            background: linear-gradient(45deg, #00ff00, #00cc00);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
        }
        
        input[type="range"] {
            width: 100px;
            margin: 0 8px;
        }
        
        .integral-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border: 2px solid #00ff00;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
        }
        
        .step {
            flex: 1;
            text-align: center;
            padding: 8px;
            margin: 0 2px;
            border-radius: 4px;
            font-size: 11px;
            transition: all 0.3s;
        }
        
        .step.active {
            background: rgba(0, 255, 0, 0.3);
            border: 1px solid #00ff00;
        }
        
        .step.inactive {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="container">
        <div id="canvas-container"></div>
        
        <!-- åˆ†æé¢æ¿ -->
        <div id="analysis-panel" class="panel">
            <div class="panel-title analysis-title">ğŸ“Š æ­£å¼¦ç§¯åˆ†æ¨å¯¼åˆ†æ</div>
            
            <div class="section physics-section">
                <div class="section-title">ğŸ”¬ ç‰©ç†åŸºç¡€</div>
                <div style="font-size: 13px; line-height: 1.5;">
                    <div>â€¢ <span class="highlight">ç©ºé—´å‘æ•£</span>ï¼šå…‰é€Ÿcå‘å„æ–¹å‘</div>
                    <div>â€¢ <span class="highlight">æ¥è§¦æœºåˆ¶</span>ï¼šç©ºé—´æ¡æ•° âˆ c</div>
                    <div>â€¢ <span class="highlight">è§’åº¦æƒé‡</span>ï¼šsinÎ¸ æŠ•å½±æ•ˆåº”</div>
                    <div>â€¢ <span class="highlight">æœ‰æ•ˆèŒƒå›´</span>ï¼šæœå‘ç›®æ ‡çš„åŠçƒ</div>
                </div>
            </div>
            
            <div class="section math-section">
                <div class="section-title">ğŸ“ å…³é”®ç§¯åˆ†</div>
                <div class="math-formula">
                    å…¨ç©ºé—´ç§¯åˆ†:<br>
                    <span class="highlight">âˆ«â‚€^Ï€ sinÎ¸ dÎ¸ = 2</span>
                </div>
                <div class="math-formula">
                    åŠçƒç§¯åˆ†:<br>
                    <span class="success">âˆ«â‚€^(Ï€/2) sinÎ¸ dÎ¸ = 1</span>
                </div>
                <div class="integral-display">
                    å‡ ä½•å› å­ = <span class="highlight">2/1 = 2</span>
                </div>
            </div>
            
            <div class="section insight-section">
                <div class="section-title">ğŸ’¡ æ ¸å¿ƒæ´å¯Ÿ</div>
                <div style="font-size: 12px; line-height: 1.4;">
                    <div class="success">âœ“ ç®€æ´æ€§ï¼šç›´æ¥ä»sinÎ¸ç§¯åˆ†å¾—å‡º</div>
                    <div class="success">âœ“ ç‰©ç†æ€§ï¼šåŸºäºå…‰é€Ÿæ¥è§¦æœºåˆ¶</div>
                    <div class="success">âœ“ å¯¹ç§°æ€§ï¼šä½“ç°3Dâ†’2Dè½¬æ¢</div>
                    <div class="warning">âš  éœ€è¦æ˜ç¡®sinÎ¸çš„ç‰©ç†æ¥æº</div>
                </div>
            </div>
            
            <div class="step-indicator">
                <div class="step active" id="step1">ç‰©ç†å»ºæ¨¡</div>
                <div class="step inactive" id="step2">è§’åº¦åˆ†æ</div>
                <div class="step inactive" id="step3">ç§¯åˆ†è®¡ç®—</div>
                <div class="step inactive" id="step4">å› å­æ¨å¯¼</div>
            </div>
        </div>
        
        <!-- å¯¹æ¯”é¢æ¿ -->
        <div id="comparison-panel" class="panel">
            <div class="panel-title comparison-title">âš–ï¸ æ–¹æ³•å¯¹æ¯”è¯„ä¼°</div>
            
            <div class="section comparison-section">
                <div class="section-title">ğŸ† ä¼˜åŠ¿åˆ†æ</div>
                <div style="font-size: 12px; line-height: 1.5;">
                    <div class="success"><strong>æ•°å­¦ç®€æ´æ€§ â˜…â˜…â˜…â˜…â˜…</strong></div>
                    <div>â€¢ åªéœ€è¦åŸºæœ¬çš„æ­£å¼¦ç§¯åˆ†</div>
                    <div>â€¢ é¿å…å¤æ‚çš„ç«‹ä½“è§’è®¡ç®—</div>
                    <div>â€¢ ç»“æœç›´è§‚ï¼š2/1=2</div>
                    
                    <div class="success"><strong>ç‰©ç†ç›´è§‚æ€§ â˜…â˜…â˜…â˜…â˜†</strong></div>
                    <div>â€¢ ç©ºé—´æ¥è§¦é€Ÿåº¦æ¦‚å¿µæ¸…æ™°</div>
                    <div>â€¢ å…‰é€Ÿcçš„ç‰©ç†æ„ä¹‰æ˜ç¡®</div>
                    <div>â€¢ sinÎ¸æƒé‡å®¹æ˜“ç†è§£</div>
                </div>
            </div>
            
            <div class="section comparison-section">
                <div class="section-title">âš ï¸ æ½œåœ¨é—®é¢˜</div>
                <div style="font-size: 12px; line-height: 1.5;">
                    <div class="warning"><strong>ç†è®ºå®Œæ•´æ€§</strong></div>
                    <div>â€¢ ä¸ºä»€ä¹ˆæƒé‡æ˜¯sinÎ¸è€ŒécosÎ¸ï¼Ÿ</div>
                    <div>â€¢ å…¨ç©ºé—´vsåŠçƒçš„åˆ’åˆ†ä¾æ®ï¼Ÿ</div>
                    
                    <div class="warning"><strong>ä¸å…¶ä»–æ–¹æ³•çš„å…³ç³»</strong></div>
                    <div>â€¢ å¦‚ä½•ä¸sinÂ²Î¸æ–¹æ³•ç»Ÿä¸€ï¼Ÿ</div>
                    <div>â€¢ æ ‡å‡†åŒ–å¸¸æ•°8/Ï€åœ¨å“ªé‡Œï¼Ÿ</div>
                </div>
            </div>
            
            <div class="section comparison-section">
                <div class="section-title">ğŸ”— æ–¹æ³•ç»Ÿä¸€</div>
                <div style="font-size: 12px;">
                    <div class="math-formula">
                        sinÂ²Î¸æ–¹æ³•: âˆ«â‚€^Ï€ sinÂ²Î¸ dÎ¸ = Ï€/2<br>
                        æ ‡å‡†åŒ–å: (Ï€/2)Ã—(8/Ï€)Ã·2 = 2
                    </div>
                    <div class="math-formula">
                        sinÎ¸æ–¹æ³•: âˆ«â‚€^Ï€ sinÎ¸ dÎ¸ = 2<br>
                        ç›´æ¥å¾—åˆ°: 2Ã·1 = 2
                    </div>
                    <div class="highlight">ä¸¤ç§æ–¹æ³•æ®Šé€”åŒå½’ï¼</div>
                </div>
            </div>
            
            <div id="method-rating">
                <div style="text-align: center; margin-top: 15px;">
                    <div class="success" style="font-size: 16px;">ç»¼åˆè¯„åˆ†: â˜…â˜…â˜…â˜…â˜†</div>
                    <div style="font-size: 12px; color: #aaa;">
                        ç®€æ´è€Œæœ‰æ•ˆçš„è¡¥å……æ–¹æ³•
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div id="visualization-controls" class="panel">
            <div class="panel-title controls-title">ğŸ›ï¸ å¯è§†åŒ–æ§åˆ¶</div>
            
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="text-align: center;">
                    <div style="font-size: 12px; margin-bottom: 5px;">ç§¯åˆ†èŒƒå›´</div>
                    <button onclick="setIntegralRange('full')" id="full-btn" class="active">0â†’Ï€</button>
                    <button onclick="setIntegralRange('half')" id="half-btn">0â†’Ï€/2</button>
                </div>
                
                <div style="text-align: center;">
                    <div style="font-size: 12px; margin-bottom: 5px;">å‡½æ•°æ˜¾ç¤º</div>
                    <button onclick="setFunction('sin')" id="sin-btn" class="active">sinÎ¸</button>
                    <button onclick="setFunction('sin2')" id="sin2-btn">sinÂ²Î¸</button>
                    <button onclick="setFunction('cos')" id="cos-btn">cosÎ¸</button>
                </div>
                
                <div style="text-align: center;">
                    <div style="font-size: 12px; margin-bottom: 5px;">åŠ¨ç”»é€Ÿåº¦</div>
                    <input type="range" id="speed-slider" min="0.5" max="3" step="0.1" value="1.5">
                </div>
                
                <div style="text-align: center;">
                    <div style="font-size: 12px; margin-bottom: 5px;">æ˜¾ç¤ºæ¨¡å¼</div>
                    <button onclick="toggleMode()" id="mode-btn">3Dæ¨¡å¼</button>
                    <button onclick="resetView()">é‡ç½®</button>
                </div>
            </div>
            
            <div style="margin-top: 15px; text-align: center; font-size: 12px;">
                å½“å‰ç§¯åˆ†å€¼: <span id="current-integral" class="highlight">2.000</span> | 
                å‡ ä½•å› å­: <span id="geometric-factor" class="success">2.000</span>
            </div>
        </div>
    </div>

    <script>
        let scene, camera, renderer;
        let integralCurve, projectionPlane, coordinateSystem;
        let animationId, isAnimating = true;
        let time = 0, animationSpeed = 1.5;
        let currentFunction = 'sin', currentRange = 'full';
        let integralPoints = [], currentStep = 1;
        
        function init() {
            setupScene();
            createGeometry();
            createIntegralVisualization();
            setupLighting();
            setupControls();
            animate();
        }
        
        function setupScene() {
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x0c0c2e, 20, 100);
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(25, 15, 25);
            camera.lookAt(0, 0, 0);
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.setClearColor(0x0c0c2e, 0.8);
            
            document.getElementById('canvas-container').appendChild(renderer.domElement);
        }
        
        function createGeometry() {
            // åæ ‡ç³»
            coordinateSystem = new THREE.Group();
            
            // Î¸è½´ (0åˆ°Ï€)
            const thetaAxis = new THREE.ArrowHelper(
                new THREE.Vector3(1, 0, 0),
                new THREE.Vector3(-15, 0, 0),
                30, 0xff0000, 3, 1.5
            );
            coordinateSystem.add(thetaAxis);
            
            // å‡½æ•°å€¼è½´
            const valueAxis = new THREE.ArrowHelper(
                new THREE.Vector3(0, 1, 0),
                new THREE.Vector3(-15, 0, 0),
                20, 0x00ff00, 3, 1.5
            );
            coordinateSystem.add(valueAxis);
            
            // Zè½´ (3Dæ‰©å±•)
            const zAxis = new THREE.ArrowHelper(
                new THREE.Vector3(0, 0, 1),
                new THREE.Vector3(-15, 0, -15),
                30, 0x0000ff, 3, 1.5
            );
            coordinateSystem.add(zAxis);
            
            scene.add(coordinateSystem);
            
            // æ·»åŠ æ ‡ç­¾
            addAxisLabels();
            
            // ç§¯åˆ†åŒºåŸŸ
            createIntegralArea();
        }
        
        function addAxisLabels() {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ·»åŠ æ–‡æœ¬æ ‡ç­¾
            // ç”±äºThree.jsæ–‡æœ¬æ¸²æŸ“å¤æ‚ï¼Œè¿™é‡Œç”¨ç®€å•å‡ ä½•ä½“ä»£æ›¿
            
            // Î¸ = 0 æ ‡è®°
            const zeroMarker = new THREE.Mesh(
                new THREE.SphereGeometry(0.5),
                new THREE.MeshBasicMaterial({ color: 0xffffff })
            );
            zeroMarker.position.set(-15, 0, 0);
            scene.add(zeroMarker);
            
            // Î¸ = Ï€/2 æ ‡è®°  
            const piHalfMarker = new THREE.Mesh(
                new THREE.SphereGeometry(0.5),
                new THREE.MeshBasicMaterial({ color: 0xffff00 })
            );
            piHalfMarker.position.set(0, 0, 0);
            scene.add(piHalfMarker);
            
            // Î¸ = Ï€ æ ‡è®°
            const piMarker = new THREE.Mesh(
                new THREE.SphereGeometry(0.5),
                new THREE.MeshBasicMaterial({ color: 0xff0000 })
            );
            piMarker.position.set(15, 0, 0);
            scene.add(piMarker);
        }
        
        function createIntegralArea() {
            // åˆ›å»ºå¯å˜çš„ç§¯åˆ†åŒºåŸŸæ˜¾ç¤º
            const integralGeometry = new THREE.PlaneGeometry(30, 20, 100, 50);
            const integralMaterial = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 },
                    functionType: { value: 0 }, // 0=sin, 1=sinÂ², 2=cos
                    integralRange: { value: 1 }, // 0=åŠçƒ, 1=å…¨çƒ
                    animationProgress: { value: 0 }
                },
                vertexShader: `
                    uniform float time;
                    uniform int functionType;
                    uniform int integralRange;
                    uniform float animationProgress;
                    
                    varying vec3 vPosition;
                    varying vec2 vUv;
                    varying float vFunctionValue;
                    
                    void main() {
                        vPosition = position;
                        vUv = uv;
                        
                        float theta = (uv.x - 0.5) * 3.14159; // -Ï€/2 åˆ° Ï€/2ï¼Œç„¶åæ˜ å°„åˆ° 0 åˆ° Ï€
                        theta = (theta + 1.5708) / 3.14159 * 3.14159; // 0 åˆ° Ï€
                        
                        float functionValue = 0.0;
                        if (functionType == 0) { // sinÎ¸
                            functionValue = sin(theta);
                        } else if (functionType == 1) { // sinÂ²Î¸  
                            functionValue = sin(theta) * sin(theta);
                        } else if (functionType == 2) { // cosÎ¸
                            functionValue = cos(theta);
                        }
                        
                        vFunctionValue = functionValue;
                        
                        vec3 pos = position;
                        pos.y = functionValue * 10.0 * (uv.y * 0.5 + 0.5);
                        pos.x = (uv.x - 0.5) * 30.0; // Î¸æ–¹å‘
                        
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform float time;
                    uniform float animationProgress;
                    
                    varying vec3 vPosition;
                    varying vec2 vUv;
                    varying float vFunctionValue;
                    
                    void main() {
                        float alpha = 0.6;
                        
                        // åŸºäºå‡½æ•°å€¼çš„é¢œè‰²
                        vec3 color = mix(
                            vec3(0.2, 0.4, 1.0), // è“è‰²
                            vec3(1.0, 0.4, 0.2), // æ©™è‰²
                            vFunctionValue
                        );
                        
                        // ç§¯åˆ†åŒºåŸŸé«˜äº®
                        float theta = (vUv.x - 0.5) * 3.14159 + 1.5708;
                        if (theta <= animationProgress) {
                            color *= 1.5;
                            alpha *= 1.3;
                        }
                        
                        gl_FragColor = vec4(color, alpha);
                    }
                `,
                transparent: true,
                side: THREE.DoubleSide
            });
            
            integralCurve = new THREE.Mesh(integralGeometry, integralMaterial);
            scene.add(integralCurve);
        }
        
        function createIntegralVisualization() {
            // è¿™é‡Œåˆ›å»ºå®æ—¶çš„ç§¯åˆ†å¯è§†åŒ–æ•ˆæœ
            updateIntegralCurve();
        }
        
        function setupLighting() {
            const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(30, 30, 30);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // æ·»åŠ å½©è‰²ç‚¹å…‰æº
            const colorLights = [
                { color: 0x00ffff, pos: [20, 10, 20] },
                { color: 0xff6b35, pos: [-20, 10, -20] },
                { color: 0xff00ff, pos: [0, 20, 0] }
            ];
            
            colorLights.forEach(({ color, pos }) => {
                const light = new THREE.PointLight(color, 0.8, 50);
                light.position.set(...pos);
                scene.add(light);
            });
        }
        
        function setupControls() {
            // é¼ æ ‡æ§åˆ¶
            let mouseDown = false;
            let mouseX = 0, mouseY = 0;
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                mouseDown = true;
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            document.addEventListener('mouseup', () => {
                mouseDown = false;
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (!mouseDown) return;
                
                const deltaX = e.clientX - mouseX;
                const deltaY = e.clientY - mouseY;
                
                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);
                spherical.theta -= deltaX * 0.01;
                spherical.phi += deltaY * 0.01;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                
                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);
                
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            // æ»šè½®ç¼©æ”¾
            renderer.domElement.addEventListener('wheel', (e) => {
                const scaleFactor = e.deltaY > 0 ? 1.1 : 0.9;
                camera.position.multiplyScalar(scaleFactor);
                camera.position.clampLength(10, 80);
            });
            
            // é€Ÿåº¦æ»‘å—
            document.getElementById('speed-slider').addEventListener('input', (e) => {
                animationSpeed = parseFloat(e.target.value);
            });
        }
        
        function animate() {
            if (isAnimating) {
                time += 0.016 * animationSpeed;
                updateVisualization();
                updateUI();
                updateStepIndicator();
            }
            
            renderer.render(scene, camera);
            animationId = requestAnimationFrame(animate);
        }
        
        function updateVisualization() {
            if (integralCurve && integralCurve.material.uniforms) {
                integralCurve.material.uniforms.time.value = time;
                integralCurve.material.uniforms.animationProgress.value = (Math.sin(time * 0.8) + 1) * 0.5 * Math.PI;
                
                // æ›´æ–°å‡½æ•°ç±»å‹
                let funcType = 0;
                if (currentFunction === 'sin2') funcType = 1;
                else if (currentFunction === 'cos') funcType = 2;
                integralCurve.material.uniforms.functionType.value = funcType;
                
                // æ›´æ–°ç§¯åˆ†èŒƒå›´
                integralCurve.material.uniforms.integralRange.value = currentRange === 'full' ? 1 : 0;
            }
        }
        
        function updateUI() {
            const progress = (Math.sin(time * 0.8) + 1) * 0.5;
            const currentTheta = progress * Math.PI;
            
            let integralValue = 0;
            if (currentFunction === 'sin') {
                if (currentRange === 'full') {
                    integralValue = 2 * progress; // âˆ«â‚€^(progress*Ï€) sinÎ¸ dÎ¸
                } else {
                    integralValue = Math.min(1, 2 * progress); // âˆ«â‚€^(progress*Ï€/2) sinÎ¸ dÎ¸
                }
            } else if (currentFunction === 'sin2') {
                if (currentRange === 'full') {
                    integralValue = (Math.PI / 2) * progress;
                } else {
                    integralValue = (Math.PI / 4) * progress;
                }
            } else if (currentFunction === 'cos') {
                integralValue = Math.sin(currentTheta) - Math.sin(0);
            }
            
            document.getElementById('current-integral').textContent = integralValue.toFixed(3);
            
            // è®¡ç®—å‡ ä½•å› å­
            let geometricFactor = 1;
            if (currentFunction === 'sin') {
                geometricFactor = 2 / 1; // 2Ã·1
            } else if (currentFunction === 'sin2') {
                geometricFactor = (Math.PI / 2) / (Math.PI / 4) * (8 / Math.PI) / 4; // å¤æ‚è®¡ç®—ç®€åŒ–
            }
            
            document.getElementById('geometric-factor').textContent = geometricFactor.toFixed(3);
        }
        
        function updateStepIndicator() {
            const progress = (Math.sin(time * 0.8) + 1) * 0.5;
            let step = Math.floor(progress * 4) + 1;
            step = Math.max(1, Math.min(4, step));
            
            if (step !== currentStep) {
                currentStep = step;
                
                // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
                for (let i = 1; i <= 4; i++) {
                    const stepEl = document.getElementById(`step${i}`);
                    stepEl.className = i <= step ? 'step active' : 'step inactive';
                }
            }
        }
        
        function updateIntegralCurve() {
            // æ›´æ–°ç§¯åˆ†æ›²çº¿æ˜¾ç¤º
            if (integralCurve) {
                const geometry = integralCurve.geometry;
                const positions = geometry.attributes.position.array;
                
                for (let i = 0; i < positions.length; i += 3) {
                    const x = positions[i];
                    const theta = (x + 15) / 30 * Math.PI; // æ˜ å°„åˆ°0-Ï€
                    
                    let y = 0;
                    if (currentFunction === 'sin') {
                        y = Math.sin(theta) * 10;
                    } else if (currentFunction === 'sin2') {
                        y = Math.sin(theta) * Math.sin(theta) * 10;
                    } else if (currentFunction === 'cos') {
                        y = Math.cos(theta) * 10;
                    }
                    
                    positions[i + 1] = y;
                }
                
                geometry.attributes.position.needsUpdate = true;
            }
        }
        
        // æ§åˆ¶å‡½æ•°
        function setIntegralRange(range) {
            currentRange = range;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('full-btn').classList.remove('active');
            document.getElementById('half-btn').classList.remove('active');
            document.getElementById(`${range}-btn`).classList.add('active');
            
            updateIntegralCurve();
        }
        
        function setFunction(func) {
            currentFunction = func;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('sin-btn').classList.remove('active');
            document.getElementById('sin2-btn').classList.remove('active');
            document.getElementById('cos-btn').classList.remove('active');
            document.getElementById(`${func}-btn`).classList.add('active');
            
            updateIntegralCurve();
        }
        
        function toggleMode() {
            // åˆ‡æ¢2D/3Dæ˜¾ç¤ºæ¨¡å¼
            const btn = document.getElementById('mode-btn');
            if (btn.textContent === '3Dæ¨¡å¼') {
                btn.textContent = '2Dæ¨¡å¼';
                camera.position.set(0, 30, 0.1);
                camera.lookAt(0, 0, 0);
            } else {
                btn.textContent = '3Dæ¨¡å¼';
                camera.position.set(25, 15, 25);
                camera.lookAt(0, 0, 0);
            }
        }
        
        function resetView() {
            camera.position.set(25, 15, 25);
            camera.lookAt(0, 0, 0);
            time = 0;
            document.getElementById('mode-btn').textContent = '3Dæ¨¡å¼';
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        window.addEventListener('resize', onWindowResize, false);
        
        // å¯åŠ¨å¯è§†åŒ–
        init();
        
        // å®šæœŸæ›´æ–°åˆ†æå†…å®¹
        setInterval(updateAnalysisContent, 2000);
        
        function updateAnalysisContent() {
            const progress = (Math.sin(time * 0.8) + 1) * 0.5;
            
            // åŠ¨æ€æ›´æ–°åˆ†æé¢æ¿å†…å®¹
            const analysisSteps = [
                "ç‰©ç†å»ºæ¨¡ï¼šç©ºé—´ä»¥å…‰é€Ÿcå‘æ•£",
                "è§’åº¦åˆ†æï¼šsinÎ¸æƒé‡åˆ†å¸ƒ",  
                "ç§¯åˆ†è®¡ç®—ï¼šâˆ«sinÎ¸ dÎ¸ = 2",
                "å› å­æ¨å¯¼ï¼š2Ã·1 = 2"
            ];
            
            const currentStepText = analysisSteps[currentStep - 1] || analysisSteps[0];
            
            // æ›´æ–°å½“å‰æ­¥éª¤æ˜¾ç¤º
            if (document.getElementById('current-step')) {
                document.getElementById('current-step').textContent = `æ­¥éª¤${currentStep}: ${currentStepText}`;
            }
        }
    </script>
</body>
</html>