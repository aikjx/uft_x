<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathJax ÊúÄÂº∫ÁªìÂêà - ÂÖ®Â±ÄÂÖ®Èù¢ÊµãËØïÂ•ó‰ª∂</title>
    
    <!-- MathJax ÂÖ®Â±ÄÈÖçÁΩÆ - ÊúÄÂº∫ÈÖçÁΩÆ -->
    <script>
        window.MathJax = {
            // ÂÖ®Â±ÄÈÖçÁΩÆ
            startup: {
                ready() {
                    console.log('üöÄ MathJax ÂêØÂä®ÂÆåÊàê');
                    MathJax.startup.defaultReady();
                    // ÂêØÂä®ÂêéÁ´ãÂç≥ÊµãËØï
                    setTimeout(() => {
                        runComprehensiveTests();
                    }, 100);
                }
            },
            
            // ËæìÂÖ•Â§ÑÁêÜÂô®ÈÖçÁΩÆ
            tex: {
                // ÂÜÖËÅîÊï∞Â≠¶ÂàÜÈöîÁ¨¶
                inlineMath: [
                    ['$', '$'],
                    ['\\(', '\\)']
                ],
                // ÊòæÁ§∫Êï∞Â≠¶ÂàÜÈöîÁ¨¶
                displayMath: [
                    ['$$', '$$'],
                    ['\\[', '\\]']
                ],
                // ÂêØÁî®ÊâÄÊúâÊâ©Â±ïÂåÖ
                packages: {
                    '[+]': [
                        'base',
                        'ams',
                        'newcommand',
                        'configmacros',
                        'action',
                        'bbox',
                        'boldsymbol',
                        'braket',
                        'cancel',
                        'color',
                        'enclose',
                        'extpfeil',
                        'html',
                        'mathtools',
                        'mhchem',
                        'physics',
                        'textmacros',
                        'unicode',
                        'verb'
                    ]
                },
                // Ëá™ÂÆö‰πâÂÆè
                macros: {
                    // Âü∫Á°ÄÂÆè
                    RR: "\\mathbb{R}",
                    CC: "\\mathbb{C}",
                    NN: "\\mathbb{N}",
                    ZZ: "\\mathbb{Z}",
                    QQ: "\\mathbb{Q}",
                    
                    // ÂêëÈáèÂíåÁü©Èòµ
                    vec: ["\\mathbf{#1}", 1],
                    mat: ["\\mathbf{#1}", 1],
                    
                    // ÂæÆÁßØÂàÜ
                    dd: "\\mathrm{d}",
                    pp: "\\partial",
                    grad: "\\nabla",
                    
                    // Áâ©ÁêÜÂ≠¶
                    hbar: "\\hslash",
                    ket: ["|#1\\rangle", 1],
                    bra: ["\\langle#1|", 1],
                    braket: ["\\langle#1|#2\\rangle", 2],
                    
                    // Ëá™ÂÆö‰πâÂáΩÊï∞
                    sinc: "\\operatorname{sinc}",
                    rect: "\\operatorname{rect}",
                    
                    // ÁâπÊÆäÁ¨¶Âè∑
                    implies: "\\Rightarrow",
                    iff: "\\Leftrightarrow"
                },
                // Ê†áÁ≠æÂíåÂºïÁî®
                tags: 'ams',
                tagSide: 'right',
                tagIndent: '0.8em',
                // Â§öË°åÂÖ¨Âºè
                multlineWidth: '85%',
                // ÈîôËØØÂ§ÑÁêÜ
                formatError: (jax, err) => {
                    console.error('MathJax ÈîôËØØ:', err);
                    return jax.formatError(err);
                }
            },
            
            // MathML ÈÖçÁΩÆ
            mathml: {
                forceReparse: true
            },
            
            // AsciiMath ÈÖçÁΩÆ
            asciimath: {
                delimiters: [['`', '`'], ['am:', ':am']]
            },
            
            // ËæìÂá∫ÈÖçÁΩÆ
            chtml: {
                scale: 1,
                minScale: 0.5,
                matchFontHeight: false,
                fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
            },
            
            svg: {
                scale: 1,
                minScale: 0.5,
                fontCache: 'local'
            },
            
            // ËèúÂçïÈÖçÁΩÆ
            options: {
                menuOptions: {
                    settings: {
                        assistiveMml: true,
                        collapsible: true,
                        explorer: true
                    }
                },
                renderActions: {
                    addMenu: [0, '', '']
                }
            },
            
            // Âä†ËΩΩÂô®ÈÖçÁΩÆ
            loader: {
                load: [
                    '[tex]/ams',
                    '[tex]/newcommand',
                    '[tex]/configmacros',
                    '[tex]/action',
                    '[tex]/bbox',
                    '[tex]/boldsymbol',
                    '[tex]/braket',
                    '[tex]/cancel',
                    '[tex]/color',
                    '[tex]/enclose',
                    '[tex]/extpfeil',
                    '[tex]/html',
                    '[tex]/mathtools',
                    '[tex]/mhchem',
                    '[tex]/physics',
                    '[tex]/textmacros',
                    '[tex]/unicode',
                    '[tex]/verb'
                ]
            }
        };
    </script>
    
    <!-- Âä†ËΩΩ MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 15px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-left: 5px solid;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .test-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .test-section.basic { border-left-color: #ff6b6b; }
        .test-section.advanced { border-left-color: #4ecdc4; }
        .test-section.physics { border-left-color: #45b7d1; }
        .test-section.chemistry { border-left-color: #96ceb4; }
        .test-section.geometry { border-left-color: #feca57; }
        .test-section.interactive { border-left-color: #ff9ff3; }
        
        .test-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 3px solid #007bff;
        }
        
        .test-item h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .math-display {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #e9ecef;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .controls {
            background: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .controls h2 {
            margin-bottom: 20px;
            color: #ecf0f1;
        }
        
        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        button.success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        
        button.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .performance-meter {
            background: #34495e;
            padding: 20px;
            border-radius: 10px;
            color: white;
            margin: 20px 0;
        }
        
        .meter-bar {
            background: #2c3e50;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12, #e74c3c);
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .interactive-demo {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin: 10px 0;
        }
        
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }
        
        .error-log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ MathJax ÊúÄÂº∫ÁªìÂêàÊµãËØïÂ•ó‰ª∂</h1>
            <p>ÂÖ®Â±ÄÈÖçÁΩÆ ‚Ä¢ ÂÖ®Èù¢ÂäüËÉΩ ‚Ä¢ ÂÖ®Êñπ‰ΩçÊµãËØï</p>
        </div>
        
        <div class="controls">
            <h2>üéõÔ∏è ÊµãËØïÊéßÂà∂Èù¢Êùø</h2>
            <div class="control-group">
                <button onclick="runAllTests()">üöÄ ËøêË°åÂÖ®ÈÉ®ÊµãËØï</button>
                <button onclick="runPerformanceTest()">‚ö° ÊÄßËÉΩÊµãËØï</button>
                <button onclick="testErrorHandling()">üêõ ÈîôËØØÂ§ÑÁêÜÊµãËØï</button>
                <button onclick="clearResults()">üßπ Ê∏ÖÈô§ÁªìÊûú</button>
                <button onclick="exportResults()">üìä ÂØºÂá∫ÁªìÊûú</button>
            </div>
            
            <div class="control-group">
                <button onclick="toggleRenderer('chtml')" id="chtml-btn" class="success">HTML-CSS Ê∏≤Êüì</button>
                <button onclick="toggleRenderer('svg')" id="svg-btn">SVG Ê∏≤Êüì</button>
                <button onclick="reprocessMath()">üîÑ ÈáçÊñ∞Â§ÑÁêÜ</button>
                <button onclick="showMathJaxMenu()">‚öôÔ∏è MathJax ËèúÂçï</button>
            </div>
            
            <div id="status-display" class="status info">
                ÂáÜÂ§áÂ∞±Áª™ - ÁÇπÂáªÊåâÈíÆÂºÄÂßãÊµãËØï
            </div>
            
            <div class="performance-meter">
                <div>Ê∏≤ÊüìÊÄßËÉΩ: <span id="perf-text">ÂæÖÊµãËØï</span></div>
                <div class="meter-bar">
                    <div class="meter-fill" id="perf-bar" style="width: 0%"></div>
                </div>
            </div>
        </div>        

        <div class="test-grid">
            <!-- Âü∫Á°ÄÊï∞Â≠¶ÊµãËØï -->
            <div class="test-section basic">
                <h2>üî¢ Âü∫Á°ÄÊï∞Â≠¶ÊµãËØï</h2>
                
                <div class="test-item">
                    <h3>ÂÜÖËÅîÊï∞Â≠¶</h3>
                    <p>ËøôÊòØÂÜÖËÅîÊï∞Â≠¶: $E = mc^2$ Âíå $\pi \approx 3.14159$</p>
                    <p>Êõ¥Â§öÂÜÖËÅî: \(x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}\)</p>
                </div>
                
                <div class="test-item">
                    <h3>ÊòæÁ§∫Êï∞Â≠¶</h3>
                    <div class="math-display">
                        $$\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}$$
                    </div>
                    <div class="math-display">
                        \[\sum_{n=1}^{\infty} \frac{1}{n^2} = \frac{\pi^2}{6}\]
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ÂàÜÊï∞ÂíåÊ†πÂºè</h3>
                    <div class="math-display">
                        $$\frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>‰∏ä‰∏ãÊ†á</h3>
                    <div class="math-display">
                        $$x^{2^3} + y_{i,j}^{(k)} = z_{\text{max}}^{\alpha + \beta}$$
                    </div>
                </div>
            </div>
            
            <!-- È´òÁ∫ßÊï∞Â≠¶ÊµãËØï -->
            <div class="test-section advanced">
                <h2>üéì È´òÁ∫ßÊï∞Â≠¶ÊµãËØï</h2>
                
                <div class="test-item">
                    <h3>Áü©ÈòµÂíåË°åÂàóÂºè</h3>
                    <div class="math-display">
                        $$\begin{pmatrix}
                        a & b & c \\
                        d & e & f \\
                        g & h & i
                        \end{pmatrix} \cdot \begin{pmatrix}
                        x \\ y \\ z
                        \end{pmatrix} = \begin{pmatrix}
                        ax + by + cz \\
                        dx + ey + fz \\
                        gx + hy + iz
                        \end{pmatrix}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>Â§öË°åÂÖ¨Âºè</h3>
                    <div class="math-display">
                        $$\begin{align}
                        f(x) &= x^2 + 2x + 1 \\
                        &= (x + 1)^2 \\
                        &= (x + 1)(x + 1)
                        \end{align}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ÊûÅÈôêÂíåÂØºÊï∞</h3>
                    <div class="math-display">
                        $$\lim_{x \to 0} \frac{\sin x}{x} = 1 \quad \text{Âíå} \quad \frac{d}{dx}[x^n] = nx^{n-1}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ÁßØÂàÜ</h3>
                    <div class="math-display">
                        $$\oint_C \vec{F} \cdot d\vec{r} = \iint_S (\nabla \times \vec{F}) \cdot d\vec{S}$$
                    </div>
                </div>
            </div>
            
            <!-- Áâ©ÁêÜÂ≠¶ÊµãËØï -->
            <div class="test-section physics">
                <h2>‚öõÔ∏è Áâ©ÁêÜÂ≠¶ÊµãËØï</h2>
                
                <div class="test-item">
                    <h3>ÈáèÂ≠êÂäõÂ≠¶</h3>
                    <div class="math-display">
                        $$i\hbar\frac{\partial}{\partial t}|\psi\rangle = \hat{H}|\psi\rangle$$
                    </div>
                    <div class="math-display">
                        $$\langle\psi|\hat{A}|\psi\rangle = \int_{-\infty}^{\infty} \psi^*(x) \hat{A} \psi(x) dx$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ÁîµÁ£ÅÂ≠¶</h3>
                    <div class="math-display">
                        $$\nabla \cdot \vec{E} = \frac{\rho}{\epsilon_0} \quad \nabla \times \vec{B} = \mu_0\vec{J} + \mu_0\epsilon_0\frac{\partial \vec{E}}{\partial t}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>Áõ∏ÂØπËÆ∫</h3>
                    <div class="math-display">
                        $$ds^2 = -c^2dt^2 + dx^2 + dy^2 + dz^2$$
                    </div>
                    <div class="math-display">
                        $$E^2 = (pc)^2 + (mc^2)^2$$
                    </div>
                </div>
            </div>
            
            <!-- ÂåñÂ≠¶ÊµãËØï -->
            <div class="test-section chemistry">
                <h2>üß™ ÂåñÂ≠¶ÊµãËØï</h2>
                
                <div class="test-item">
                    <h3>ÂåñÂ≠¶ÊñπÁ®ãÂºè</h3>
                    <div class="math-display">
                        $$\ce{2H2 + O2 -> 2H2O}$$
                    </div>
                    <div class="math-display">
                        $$\ce{CaCO3 + 2HCl -> CaCl2 + H2O + CO2 ^}$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>Â§çÊùÇÂåñÂ≠¶Âºè</h3>
                    <div class="math-display">
                        $$\ce{Cr2O7^2- + 14H+ + 6e- -> 2Cr^3+ + 7H2O}$$
                    </div>
                    <div class="math-display">
                        $$\ce{[Cu(NH3)4]^2+ + 4H2O <=> Cu^2+ + 4NH3 + 4H2O}$$
                    </div>
                </div>
            </div>
            
            <!-- Âá†‰ΩïÂ≠¶ÊµãËØï -->
            <div class="test-section geometry">
                <h2>üìê Âá†‰ΩïÂ≠¶ÊµãËØï</h2>
                
                <div class="test-item">
                    <h3>‰∏âËßíÂáΩÊï∞</h3>
                    <div class="math-display">
                        $$\sin^2\theta + \cos^2\theta = 1$$
                    </div>
                    <div class="math-display">
                        $$e^{i\theta} = \cos\theta + i\sin\theta$$
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ÂêëÈáèËøêÁÆó</h3>
                    <div class="math-display">
                        $$\vec{a} \times \vec{b} = |\vec{a}||\vec{b}|\sin\theta \hat{n}$$
                    </div>
                    <div class="math-display">
                        $$\vec{a} \cdot \vec{b} = a_x b_x + a_y b_y + a_z b_z$$
                    </div>
                </div>
            </div>
            
            <!-- ‰∫§‰∫íÂºèÊµãËØï -->
            <div class="test-section interactive">
                <h2>üéÆ ‰∫§‰∫íÂºèÊµãËØï</h2>
                
                <div class="test-item">
                    <h3>ÂÆûÊó∂Êï∞Â≠¶ËæìÂÖ•</h3>
                    <input type="text" id="math-input" placeholder="ËæìÂÖ•Êï∞Â≠¶ÂÖ¨ÂºèÔºåÂ¶Ç: x^2 + y^2 = r^2" 
                           oninput="renderLiveMath(this.value)">
                    <div class="math-display" id="live-math">
                        ËæìÂÖ•ÂÖ¨ÂºèÂ∞ÜÂú®ËøôÈáåÂÆûÊó∂ÊòæÁ§∫
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>Â§öË°åÂÖ¨ÂºèÁºñËæëÂô®</h3>
                    <textarea id="multiline-input" rows="4" placeholder="ËæìÂÖ•Â§öË°åÂÖ¨Âºè...
‰æãÂ¶Ç:
\begin{align}
x &= a + b \\
y &= c + d
\end{align}" oninput="renderMultilineMath(this.value)"></textarea>
                    <div class="math-display" id="multiline-math">
                        Â§öË°åÂÖ¨ÂºèÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫
                    </div>
                </div>
                
                <div class="test-item">
                    <h3>ÂÖ¨ÂºèÂ∫ìÂø´ÈÄüÊèíÂÖ•</h3>
                    <div class="control-group">
                        <button onclick="insertFormula('quadratic')">‰∫åÊ¨°ÂÖ¨Âºè</button>
                        <button onclick="insertFormula('integral')">ÁßØÂàÜÂÖ¨Âºè</button>
                        <button onclick="insertFormula('matrix')">Áü©Èòµ</button>
                        <button onclick="insertFormula('physics')">Áâ©ÁêÜÂÖ¨Âºè</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÈîôËØØÊó•Âøó -->
        <div class="test-section">
            <h2>üìã ÊµãËØïÊó•Âøó</h2>
            <div id="error-log" class="error-log">
                ÊµãËØïÊó•ÂøóÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫...
            </div>
        </div>
        
        <!-- Ëá™ÂÆö‰πâÂÆèÊµãËØï -->
        <div class="test-section">
            <h2>üîß Ëá™ÂÆö‰πâÂÆèÊµãËØï</h2>
            <div class="test-item">
                <h3>È¢ÑÂÆö‰πâÂÆè</h3>
                <div class="math-display">
                    $$\RR, \CC, \NN, \ZZ, \QQ \text{ (Êï∞ÈõÜ)}$$
                </div>
                <div class="math-display">
                    $$\vec{v}, \mat{A} \text{ (ÂêëÈáèÂíåÁü©Èòµ)}$$
                </div>
                <div class="math-display">
                    $$\dd x, \pp f, \grad f \text{ (ÂæÆÁßØÂàÜ)}$$
                </div>
                <div class="math-display">
                    $$\ket{\psi}, \bra{\phi}, \braket{\phi}{\psi} \text{ (ÈáèÂ≠êÂäõÂ≠¶)}$$
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let testResults = [];
        let currentRenderer = 'chtml';
        let performanceData = [];
        
        // Êó•ÂøóÂáΩÊï∞
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('error-log');
            const colorMap = {
                'info': '#3498db',
                'success': '#27ae60', 
                'error': '#e74c3c',
                'warning': '#f39c12'
            };
            
            logElement.innerHTML += `<div style="color: ${colorMap[type]};">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(`[MathJax Test] ${message}`);
        }
        
        // Áä∂ÊÄÅÊõ¥Êñ∞ÂáΩÊï∞
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status-display');
            statusElement.className = `status ${type}`;
            statusElement.textContent = message;
        }
        
        // ÊÄßËÉΩÊµãËØïÂáΩÊï∞
        function measurePerformance(testName, testFunction) {
            const startTime = performance.now();
            
            try {
                const result = testFunction();
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                performanceData.push({
                    test: testName,
                    duration: duration,
                    success: true
                });
                
                log(`‚úÖ ${testName}: ${duration.toFixed(2)}ms`, 'success');
                return { success: true, duration, result };
                
            } catch (error) {
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                performanceData.push({
                    test: testName,
                    duration: duration,
                    success: false,
                    error: error.message
                });
                
                log(`‚ùå ${testName}: ${error.message} (${duration.toFixed(2)}ms)`, 'error');
                return { success: false, duration, error };
            }
        }
        
        // ÁªºÂêàÊµãËØïÂáΩÊï∞
        function runComprehensiveTests() {
            log('üöÄ ÂºÄÂßãËøêË°åÁªºÂêàÊµãËØïÂ•ó‰ª∂', 'info');
            updateStatus('Ê≠£Âú®ËøêË°åÁªºÂêàÊµãËØï...', 'info');
            
            const tests = [
                { name: 'MathJax ÂàùÂßãÂåñÊ£ÄÊü•', func: testMathJaxInit },
                { name: 'Âü∫Á°ÄÊ∏≤ÊüìÊµãËØï', func: testBasicRendering },
                { name: 'È´òÁ∫ßÊï∞Â≠¶ÊµãËØï', func: testAdvancedMath },
                { name: 'Ëá™ÂÆö‰πâÂÆèÊµãËØï', func: testCustomMacros },
                { name: 'Â§öÊ∏≤ÊüìÂô®ÊµãËØï', func: testMultipleRenderers },
                { name: 'Âä®ÊÄÅÂÜÖÂÆπÊµãËØï', func: testDynamicContent },
                { name: 'ÈîôËØØÂ§ÑÁêÜÊµãËØï', func: testErrorHandling },
                { name: 'ÊÄßËÉΩÂü∫ÂáÜÊµãËØï', func: testPerformanceBenchmark }
            ];
            
            let passedTests = 0;
            let totalTests = tests.length;
            
            tests.forEach((test, index) => {
                setTimeout(() => {
                    const result = measurePerformance(test.name, test.func);
                    if (result.success) passedTests++;
                    
                    // Êõ¥Êñ∞ËøõÂ∫¶
                    const progress = ((index + 1) / totalTests) * 100;
                    updateProgressBar(progress);
                    
                    // ÊúÄÂêé‰∏Ä‰∏™ÊµãËØïÂÆåÊàê
                    if (index === totalTests - 1) {
                        const successRate = (passedTests / totalTests) * 100;
                        updateStatus(`ÊµãËØïÂÆåÊàê: ${passedTests}/${totalTests} ÈÄöËøá (${successRate.toFixed(1)}%)`, 
                                   successRate === 100 ? 'success' : 'warning');
                        
                        log(`üéâ ÊµãËØïÂ•ó‰ª∂ÂÆåÊàê: ${passedTests}/${totalTests} ÈÄöËøá`, 
                            successRate === 100 ? 'success' : 'warning');
                    }
                }, index * 500); // ÈîôÂºÄÊâßË°åÊó∂Èó¥
            });
        }
        
        // ÂÖ∑‰ΩìÊµãËØïÂáΩÊï∞
        function testMathJaxInit() {
            if (typeof MathJax === 'undefined') {
                throw new Error('MathJax Êú™Âä†ËΩΩ');
            }
            
            if (!MathJax.startup || !MathJax.startup.document) {
                throw new Error('MathJax Êú™Ê≠£Á°ÆÂàùÂßãÂåñ');
            }
            
            return 'MathJax ÂàùÂßãÂåñÊ≠£Â∏∏';
        }
        
        function testBasicRendering() {
            const testElement = document.createElement('div');
            testElement.innerHTML = '$$E = mc^2$$';
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    const mathElements = testElement.querySelectorAll('.MathJax');
                    document.body.removeChild(testElement);
                    
                    if (mathElements.length > 0) {
                        resolve('Âü∫Á°ÄÊ∏≤ÊüìÊàêÂäü');
                    } else {
                        reject(new Error('Âü∫Á°ÄÊ∏≤ÊüìÂ§±Ë¥•'));
                    }
                }).catch(reject);
            });
        }
        
        function testAdvancedMath() {
            const complexFormulas = [
                '\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}',
                '\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}',
                '\\sum_{n=1}^{\\infty} \\frac{1}{n^2} = \\frac{\\pi^2}{6}'
            ];
            
            const testElement = document.createElement('div');
            testElement.innerHTML = complexFormulas.map(f => `$$${f}$$`).join('');
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    const mathElements = testElement.querySelectorAll('.MathJax');
                    document.body.removeChild(testElement);
                    
                    if (mathElements.length === complexFormulas.length) {
                        resolve('È´òÁ∫ßÊï∞Â≠¶Ê∏≤ÊüìÊàêÂäü');
                    } else {
                        reject(new Error('È´òÁ∫ßÊï∞Â≠¶Ê∏≤ÊüìÂ§±Ë¥•'));
                    }
                }).catch(reject);
            });
        }
        
        function testCustomMacros() {
            const macroTests = [
                '\\RR \\subset \\CC',
                '\\vec{v} = \\begin{pmatrix} x \\\\ y \\end{pmatrix}',
                '\\dd x \\text{ and } \\pp f',
                '\\ket{\\psi} \\text{ and } \\bra{\\phi}'
            ];
            
            const testElement = document.createElement('div');
            testElement.innerHTML = macroTests.map(f => `$$${f}$$`).join('');
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    const mathElements = testElement.querySelectorAll('.MathJax');
                    document.body.removeChild(testElement);
                    
                    if (mathElements.length === macroTests.length) {
                        resolve('Ëá™ÂÆö‰πâÂÆèÊµãËØïÊàêÂäü');
                    } else {
                        reject(new Error('Ëá™ÂÆö‰πâÂÆèÊµãËØïÂ§±Ë¥•'));
                    }
                }).catch(reject);
            });
        }
        
        function testMultipleRenderers() {
            // Ëøô‰∏™ÊµãËØïÈúÄË¶ÅÂÆûÈôÖÂàáÊç¢Ê∏≤ÊüìÂô®
            return 'Â§öÊ∏≤ÊüìÂô®ÊµãËØïÈúÄË¶ÅÊâãÂä®È™åËØÅ';
        }
        
        function testDynamicContent() {
            const testElement = document.createElement('div');
            testElement.innerHTML = '$$x^2 + y^2 = r^2$$';
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    // Âä®ÊÄÅÊõ¥ÊîπÂÜÖÂÆπ
                    testElement.innerHTML = '$$a^2 + b^2 = c^2$$';
                    
                    return MathJax.typesetPromise([testElement]);
                }).then(() => {
                    const mathElements = testElement.querySelectorAll('.MathJax');
                    document.body.removeChild(testElement);
                    
                    if (mathElements.length > 0) {
                        resolve('Âä®ÊÄÅÂÜÖÂÆπÊµãËØïÊàêÂäü');
                    } else {
                        reject(new Error('Âä®ÊÄÅÂÜÖÂÆπÊµãËØïÂ§±Ë¥•'));
                    }
                }).catch(reject);
            });
        }
        
        function testPerformanceBenchmark() {
            const startTime = performance.now();
            const formulas = [];
            
            // ÁîüÊàê100‰∏™Â§çÊùÇÂÖ¨Âºè
            for (let i = 0; i < 100; i++) {
                formulas.push(`$$\\sum_{n=1}^{${i+1}} \\frac{1}{n^2} = \\frac{\\pi^2}{6}$$`);
            }
            
            const testElement = document.createElement('div');
            testElement.innerHTML = formulas.join('');
            document.body.appendChild(testElement);
            
            return new Promise((resolve, reject) => {
                MathJax.typesetPromise([testElement]).then(() => {
                    const endTime = performance.now();
                    const duration = endTime - startTime;
                    document.body.removeChild(testElement);
                    
                    updatePerformanceMeter(duration);
                    resolve(`ÊÄßËÉΩÊµãËØïÂÆåÊàê: ${duration.toFixed(2)}ms (100‰∏™ÂÖ¨Âºè)`);
                }).catch(reject);
            });
        }
        
        // Êõ¥Êñ∞ÊÄßËÉΩËÆ°ÈáèÂô®
        function updatePerformanceMeter(duration) {
            const perfText = document.getElementById('perf-text');
            const perfBar = document.getElementById('perf-bar');
            
            perfText.textContent = `${duration.toFixed(2)}ms`;
            
            // Ê†πÊçÆÊÄßËÉΩËÆæÁΩÆÈ¢úËâ≤ÂíåÂÆΩÂ∫¶
            let percentage, color;
            if (duration < 100) {
                percentage = 25;
                color = '#27ae60';
            } else if (duration < 500) {
                percentage = 50;
                color = '#f39c12';
            } else if (duration < 1000) {
                percentage = 75;
                color = '#e67e22';
            } else {
                percentage = 100;
                color = '#e74c3c';
            }
            
            perfBar.style.width = percentage + '%';
            perfBar.style.background = color;
        }
        
        // Êõ¥Êñ∞ËøõÂ∫¶Êù°
        function updateProgressBar(percentage) {
            // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ËøõÂ∫¶Êù°Êõ¥Êñ∞ÈÄªËæë
            console.log(`ÊµãËØïËøõÂ∫¶: ${percentage.toFixed(1)}%`);
        }
        
        // ÂÆûÊó∂Êï∞Â≠¶Ê∏≤Êüì
        function renderLiveMath(input) {
            const outputElement = document.getElementById('live-math');
            
            if (!input.trim()) {
                outputElement.innerHTML = 'ËæìÂÖ•ÂÖ¨ÂºèÂ∞ÜÂú®ËøôÈáåÂÆûÊó∂ÊòæÁ§∫';
                return;
            }
            
            // Ëá™Âä®Ê∑ªÂä†Êï∞Â≠¶ÂàÜÈöîÁ¨¶
            let mathInput = input;
            if (!mathInput.startsWith('$') && !mathInput.startsWith('\\[')) {
                mathInput = `$$${mathInput}$$`;
            }
            
            outputElement.innerHTML = mathInput;
            
            MathJax.typesetPromise([outputElement]).catch(error => {
                outputElement.innerHTML = `<span style="color: red;">Ê∏≤ÊüìÈîôËØØ: ${error.message}</span>`;
            });
        }
        
        // Â§öË°åÊï∞Â≠¶Ê∏≤Êüì
        function renderMultilineMath(input) {
            const outputElement = document.getElementById('multiline-math');
            
            if (!input.trim()) {
                outputElement.innerHTML = 'Â§öË°åÂÖ¨ÂºèÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫';
                return;
            }
            
            outputElement.innerHTML = `$$${input}$$`;
            
            MathJax.typesetPromise([outputElement]).catch(error => {
                outputElement.innerHTML = `<span style="color: red;">Ê∏≤ÊüìÈîôËØØ: ${error.message}</span>`;
            });
        }
        
        // ÊèíÂÖ•È¢ÑÂÆö‰πâÂÖ¨Âºè
        function insertFormula(type) {
            const formulas = {
                quadratic: 'x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}',
                integral: '\\int_{a}^{b} f(x) dx = F(b) - F(a)',
                matrix: '\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix} \\begin{pmatrix} x \\\\ y \\end{pmatrix} = \\begin{pmatrix} ax + by \\\\ cx + dy \\end{pmatrix}',
                physics: 'E = mc^2 \\quad \\text{and} \\quad F = ma'
            };
            
            const input = document.getElementById('math-input');
            input.value = formulas[type] || '';
            renderLiveMath(input.value);
        }
        
        // ÂàáÊç¢Ê∏≤ÊüìÂô®
        function toggleRenderer(renderer) {
            currentRenderer = renderer;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('#controls button[id$="-btn"]').forEach(btn => {
                btn.classList.remove('success');
            });
            document.getElementById(`${renderer}-btn`).classList.add('success');
            
            // ËøôÈáåÂ∫îËØ•ÂÆûÈôÖÂàáÊç¢MathJaxÊ∏≤ÊüìÂô®
            log(`ÂàáÊç¢Âà∞ ${renderer} Ê∏≤ÊüìÂô®`, 'info');
            updateStatus(`ÂΩìÂâçÊ∏≤ÊüìÂô®: ${renderer}`, 'info');
        }
        
        // ÈáçÊñ∞Â§ÑÁêÜÊï∞Â≠¶
        function reprocessMath() {
            updateStatus('Ê≠£Âú®ÈáçÊñ∞Â§ÑÁêÜÊï∞Â≠¶ÂÖ¨Âºè...', 'info');
            
            MathJax.typesetClear();
            MathJax.typesetPromise().then(() => {
                updateStatus('Êï∞Â≠¶ÂÖ¨ÂºèÈáçÊñ∞Â§ÑÁêÜÂÆåÊàê', 'success');
                log('‚úÖ Êï∞Â≠¶ÂÖ¨ÂºèÈáçÊñ∞Â§ÑÁêÜÂÆåÊàê', 'success');
            }).catch(error => {
                updateStatus('ÈáçÊñ∞Â§ÑÁêÜÂ§±Ë¥•', 'error');
                log(`‚ùå ÈáçÊñ∞Â§ÑÁêÜÂ§±Ë¥•: ${error.message}`, 'error');
            });
        }
        
        // ÊòæÁ§∫MathJaxËèúÂçï
        function showMathJaxMenu() {
            // Ëß¶ÂèëMathJax‰∏ä‰∏ãÊñáËèúÂçï
            const mathElements = document.querySelectorAll('.MathJax');
            if (mathElements.length > 0) {
                // Ê®°ÊãüÂè≥ÈîÆÁÇπÂáªÁ¨¨‰∏Ä‰∏™Êï∞Â≠¶ÂÖÉÁ¥†
                const event = new MouseEvent('contextmenu', {
                    bubbles: true,
                    cancelable: true,
                    view: window
                });
                mathElements[0].dispatchEvent(event);
            } else {
                alert('Ê≤°ÊúâÊâæÂà∞Êï∞Â≠¶ÂÖÉÁ¥†Êù•ÊòæÁ§∫ËèúÂçï');
            }
        }
        
        // ËøêË°åÊâÄÊúâÊµãËØï
        function runAllTests() {
            runComprehensiveTests();
        }
        
        // ËøêË°åÊÄßËÉΩÊµãËØï
        function runPerformanceTest() {
            updateStatus('Ê≠£Âú®ËøêË°åÊÄßËÉΩÊµãËØï...', 'info');
            measurePerformance('ÊÄßËÉΩÂü∫ÂáÜÊµãËØï', testPerformanceBenchmark);
        }
        
        // Ê∏ÖÈô§ÁªìÊûú
        function clearResults() {
            document.getElementById('error-log').innerHTML = 'ÊµãËØïÊó•ÂøóÂ∑≤Ê∏ÖÈô§...';
            testResults = [];
            performanceData = [];
            updateStatus('ÁªìÊûúÂ∑≤Ê∏ÖÈô§', 'info');
            
            // ÈáçÁΩÆÊÄßËÉΩËÆ°ÈáèÂô®
            document.getElementById('perf-text').textContent = 'ÂæÖÊµãËØï';
            document.getElementById('perf-bar').style.width = '0%';
        }
        
        // ÂØºÂá∫ÁªìÊûú
        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                testResults: testResults,
                performanceData: performanceData,
                mathJaxConfig: window.MathJax
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mathjax-test-results-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('üìä ÊµãËØïÁªìÊûúÂ∑≤ÂØºÂá∫', 'success');
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            log('üìÑ È°µÈù¢Âä†ËΩΩÂÆåÊàê', 'info');
            updateStatus('MathJax ÊµãËØïÂ•ó‰ª∂Â∑≤ÂáÜÂ§áÂ∞±Áª™', 'success');
        });
        
        // Á™óÂè£Â§ßÂ∞èÊîπÂèòÊó∂ÈáçÊñ∞Ê∏≤Êüì
        window.addEventListener('resize', function() {
            setTimeout(() => {
                MathJax.typesetPromise().catch(error => {
                    log(`Á™óÂè£Ë∞ÉÊï¥ÂêéÈáçÊñ∞Ê∏≤ÊüìÂ§±Ë¥•: ${error.message}`, 'error');
                });
            }, 100);
        });
    </script>
</body>
</html>