<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathJax ‰∫§‰∫íÂºèÊµãËØïÂπ≥Âè∞</title>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                packages: {
                    '[+]': [
                        'base', 'ams', 'newcommand', 'configmacros', 'action',
                        'bbox', 'boldsymbol', 'braket', 'cancel', 'color',
                        'enclose', 'extpfeil', 'html', 'mathtools', 'mhchem',
                        'physics', 'textmacros', 'unicode', 'verb'
                    ]
                },
                macros: {
                    RR: "\\mathbb{R}",
                    CC: "\\mathbb{C}",
                    NN: "\\mathbb{N}",
                    ZZ: "\\mathbb{Z}",
                    QQ: "\\mathbb{Q}",
                    vec: ["\\mathbf{#1}", 1],
                    mat: ["\\mathbf{#1}", 1],
                    dd: "\\mathrm{d}",
                    pp: "\\partial",
                    grad: "\\nabla",
                    ket: ["|#1\\rangle", 1],
                    bra: ["\\langle#1|", 1],
                    braket: ["\\langle#1|#2\\rangle", 2]
                },
                tags: 'ams'
            },
            startup: {
                ready() {
                    console.log('MathJax ‰∫§‰∫íÂºèÊµãËØïÂπ≥Âè∞ÂáÜÂ§áÂ∞±Áª™');
                    MathJax.startup.defaultReady();
                    initializeInteractiveFeatures();
                }
            },
            options: {
                renderActions: {
                    addMenu: [0, '', '']
                }
            }
        };
    </script>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .editor-panel {
            min-height: 500px;
        }
        
        .preview-panel {
            min-height: 500px;
            background: #f8f9fa;
        }
        
        .editor-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f1f3f4;
            border-radius: 10px;
        }
        
        .toolbar-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .toolbar-group label {
            font-size: 12px;
            color: #666;
            margin-right: 5px;
        }
        
        button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
        }
        
        button.active {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        
        .math-editor {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        .math-editor:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }
        
        .preview-area {
            background: white;
            padding: 20px;
            border-radius: 10px;
            min-height: 300px;
            border: 2px solid #e9ecef;
            overflow-y: auto;
        }
        
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .template-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .template-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .template-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .template-preview {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .features-panel {
            grid-column: 1 / -1;
        }
        
        .feature-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: linear-gradient(45deg, transparent, rgba(52, 152, 219, 0.1));
        }
        
        .tab-content {
            display: none;
            padding: 20px 0;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .test-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        
        .test-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .math-output {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #e9ecef;
            min-height: 50px;
        }
        
        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .status-info {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #27ae60;
        }
        
        .error-display {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            color: #c53030;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ MathJax ‰∫§‰∫íÂºèÊµãËØïÂπ≥Âè∞</h1>
            <p>ÂÆûÊó∂ÁºñËæë„ÄÅÈ¢ÑËßàÂíåÊµãËØïÊï∞Â≠¶ÂÖ¨Âºè</p>
        </div>
        
        <div class="main-grid">
            <!-- ÁºñËæëÂô®Èù¢Êùø -->
            <div class="panel editor-panel">
                <h2>‚úèÔ∏è Êï∞Â≠¶ÂÖ¨ÂºèÁºñËæëÂô®</h2>
                
                <div class="editor-toolbar">
                    <div class="toolbar-group">
                        <label>Âø´ÈÄüÊèíÂÖ•:</label>
                        <button onclick="insertSymbol('\\\\frac{a}{b}')">ÂàÜÊï∞</button>
                        <button onclick="insertSymbol('\\\\sqrt{x}')">Ê†πÂè∑</button>
                        <button onclick="insertSymbol('x^{2}')">‰∏äÊ†á</button>
                        <button onclick="insertSymbol('x_{i}')">‰∏ãÊ†á</button>
                        <button onclick="insertSymbol('\\\\sum_{i=1}^{n}')">Ê±ÇÂíå</button>
                        <button onclick="insertSymbol('\\\\int_{a}^{b}')">ÁßØÂàÜ</button>
                    </div>
                    
                    <div class="toolbar-group">
                        <label>Â∏åËÖäÂ≠óÊØç:</label>
                        <button onclick="insertSymbol('\\\\alpha')">Œ±</button>
                        <button onclick="insertSymbol('\\\\beta')">Œ≤</button>
                        <button onclick="insertSymbol('\\\\gamma')">Œ≥</button>
                        <button onclick="insertSymbol('\\\\delta')">Œ¥</button>
                        <button onclick="insertSymbol('\\\\pi')">œÄ</button>
                        <button onclick="insertSymbol('\\\\theta')">Œ∏</button>
                    </div>
                    
                    <div class="toolbar-group">
                        <label>Êìç‰Ωú:</label>
                        <button onclick="clearEditor()">Ê∏ÖÈô§</button>
                        <button onclick="formatCode()">Ê†ºÂºèÂåñ</button>
                        <button onclick="validateSyntax()">È™åËØÅ</button>
                    </div>
                </div>
                
                <textarea id="math-editor" class="math-editor" placeholder="Âú®ËøôÈáåËæìÂÖ•Êï∞Â≠¶ÂÖ¨Âºè...
‰æãÂ¶Ç:
$$E = mc^2$$
\\begin{align}
x &= a + b \\\\
y &= c + d
\\end{align}

ÊîØÊåÅÂÜÖËÅîÊï∞Â≠¶: $x^2 + y^2 = r^2$
ÊîØÊåÅÊòæÁ§∫Êï∞Â≠¶: $$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$"></textarea>
                
                <div id="error-display" class="error-display" style="display: none;"></div>
            </div>
            
            <!-- È¢ÑËßàÈù¢Êùø -->
            <div class="panel preview-panel">
                <h2>üëÅÔ∏è ÂÆûÊó∂È¢ÑËßà</h2>
                <div id="preview-area" class="preview-area">
                    <p style="color: #666; text-align: center; margin-top: 100px;">
                        Âú®Â∑¶‰æßÁºñËæëÂô®‰∏≠ËæìÂÖ•ÂÖ¨ÂºèÔºåÈ¢ÑËßàÂ∞ÜÂú®ËøôÈáåÂÆûÊó∂ÊòæÁ§∫
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Ê®°ÊùøÂ∫ì -->
        <div class="panel">
            <h2>üìö ÂÖ¨ÂºèÊ®°ÊùøÂ∫ì</h2>
            <div class="template-grid">
                <div class="template-card" onclick="loadTemplate('quadratic')">
                    <h3>‰∫åÊ¨°ÂÖ¨Âºè</h3>
                    <div class="template-preview">x = (-b ¬± ‚àö(b¬≤-4ac)) / 2a</div>
                    <p>Ê±ÇËß£‰∫åÊ¨°ÊñπÁ®ãÁöÑÊ†áÂáÜÂÖ¨Âºè</p>
                </div>
                
                <div class="template-card" onclick="loadTemplate('matrix')">
                    <h3>Áü©ÈòµËøêÁÆó</h3>
                    <div class="template-preview">Matrix multiplication</div>
                    <p>Áü©Èòµ‰πòÊ≥ïÂíåÁ∫øÊÄßÂèòÊç¢</p>
                </div>
                
                <div class="template-card" onclick="loadTemplate('calculus')">
                    <h3>ÂæÆÁßØÂàÜ</h3>
                    <div class="template-preview">‚à´ f(x) dx</div>
                    <p>ÂØºÊï∞ÂíåÁßØÂàÜÂÖ¨Âºè</p>
                </div>
                
                <div class="template-card" onclick="loadTemplate('physics')">
                    <h3>Áâ©ÁêÜÂÖ¨Âºè</h3>
                    <div class="template-preview">E = mc¬≤</div>
                    <p>ÁªèÂÖ∏Áâ©ÁêÜÂíåÈáèÂ≠êÂäõÂ≠¶</p>
                </div>
                
                <div class="template-card" onclick="loadTemplate('statistics')">
                    <h3>ÁªüËÆ°Â≠¶</h3>
                    <div class="template-preview">Normal Distribution</div>
                    <p>Ê¶ÇÁéáÂàÜÂ∏ÉÂíåÁªüËÆ°ÂÖ¨Âºè</p>
                </div>
                
                <div class="template-card" onclick="loadTemplate('geometry')">
                    <h3>Âá†‰ΩïÂ≠¶</h3>
                    <div class="template-preview">Trigonometry</div>
                    <p>‰∏âËßíÂáΩÊï∞ÂíåÂá†‰ΩïÂÆöÁêÜ</p>
                </div>
            </div>
        </div>
        
        <!-- ÂäüËÉΩÊµãËØïÈù¢Êùø -->
        <div class="panel features-panel">
            <h2>üß™ ÂäüËÉΩÊµãËØï</h2>
            
            <div class="feature-tabs">
                <button class="tab-button active" onclick="switchTab('rendering')">Ê∏≤ÊüìÊµãËØï</button>
                <button class="tab-button" onclick="switchTab('extensions')">Êâ©Â±ïÂäüËÉΩ</button>
                <button class="tab-button" onclick="switchTab('performance')">ÊÄßËÉΩÊµãËØï</button>
                <button class="tab-button" onclick="switchTab('accessibility')">ÂèØËÆøÈóÆÊÄß</button>
            </div>
            
            <div id="rendering-tab" class="tab-content active">
                <div class="test-grid">
                    <div class="test-item">
                        <h4>Âü∫Á°ÄÊ∏≤Êüì</h4>
                        <div class="math-output" id="basic-render">$$E = mc^2$$</div>
                        <button onclick="testBasicRendering()">ÊµãËØïÂü∫Á°ÄÊ∏≤Êüì</button>
                    </div>
                    
                    <div class="test-item">
                        <h4>Â§çÊùÇÂÖ¨Âºè</h4>
                        <div class="math-output" id="complex-render"></div>
                        <button onclick="testComplexFormulas()">ÊµãËØïÂ§çÊùÇÂÖ¨Âºè</button>
                    </div>
                    
                    <div class="test-item">
                        <h4>Âä®ÊÄÅÊõ¥Êñ∞</h4>
                        <div class="math-output" id="dynamic-render">$$x = 1$$</div>
                        <button onclick="testDynamicUpdate()">ÊµãËØïÂä®ÊÄÅÊõ¥Êñ∞</button>
                    </div>
                </div>
            </div>
            
            <div id="extensions-tab" class="tab-content">
                <div class="test-grid">
                    <div class="test-item">
                        <h4>ÂåñÂ≠¶ÂÖ¨Âºè (mhchem)</h4>
                        <div class="math-output" id="chemistry-test">$$\\ce{H2O}$$</div>
                        <button onclick="testChemistry()">ÊµãËØïÂåñÂ≠¶ÂÖ¨Âºè</button>
                    </div>
                    
                    <div class="test-item">
                        <h4>Áâ©ÁêÜÁ¨¶Âè∑ (physics)</h4>
                        <div class="math-output" id="physics-test">$$\\ket{\\psi}$$</div>
                        <button onclick="testPhysics()">ÊµãËØïÁâ©ÁêÜÁ¨¶Âè∑</button>
                    </div>
                    
                    <div class="test-item">
                        <h4>È¢úËâ≤ÂíåÊ†∑Âºè</h4>
                        <div class="math-output" id="color-test">$$\\color{red}{x} + \\color{blue}{y}$$</div>
                        <button onclick="testColors()">ÊµãËØïÈ¢úËâ≤</button>
                    </div>
                </div>
            </div>
            
            <div id="performance-tab" class="tab-content">
                <div class="test-grid">
                    <div class="test-item">
                        <h4>Ê∏≤ÊüìÈÄüÂ∫¶</h4>
                        <div id="speed-result">ÁÇπÂáªÊµãËØïÊåâÈíÆÂºÄÂßã</div>
                        <button onclick="testRenderingSpeed()">ÊµãËØïÊ∏≤ÊüìÈÄüÂ∫¶</button>
                    </div>
                    
                    <div class="test-item">
                        <h4>ÂÜÖÂ≠ò‰ΩøÁî®</h4>
                        <div id="memory-result">ÁÇπÂáªÊµãËØïÊåâÈíÆÂºÄÂßã</div>
                        <button onclick="testMemoryUsage()">ÊµãËØïÂÜÖÂ≠ò‰ΩøÁî®</button>
                    </div>
                </div>
            </div>
            
            <div id="accessibility-tab" class="tab-content">
                <div class="test-grid">
                    <div class="test-item">
                        <h4>Â±èÂπïÈòÖËØªÂô®ÊîØÊåÅ</h4>
                        <div class="math-output" id="accessibility-test">$$\\frac{a}{b}$$</div>
                        <button onclick="testAccessibility()">ÊµãËØïÂèØËÆøÈóÆÊÄß</button>
                    </div>
                    
                    <div class="test-item">
                        <h4>ÈîÆÁõòÂØºËà™</h4>
                        <div id="keyboard-result">‰ΩøÁî®TabÈîÆÂØºËà™Êï∞Â≠¶ÂÖ¨Âºè</div>
                        <button onclick="testKeyboardNavigation()">ÊµãËØïÈîÆÁõòÂØºËà™</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Áä∂ÊÄÅÊ†è -->
        <div class="status-bar">
            <div class="status-info">
                <div class="status-item">
                    <div class="status-indicator" id="mathjax-status"></div>
                    <span>MathJax Áä∂ÊÄÅ</span>
                </div>
                <div class="status-item">
                    <span id="render-count">Ê∏≤ÊüìÊ¨°Êï∞: 0</span>
                </div>
                <div class="status-item">
                    <span id="last-render-time">‰∏äÊ¨°Ê∏≤Êüì: -</span>
                </div>
            </div>
            <div>
                <button onclick="exportCode()">üì§ ÂØºÂá∫‰ª£Á†Å</button>
                <button onclick="shareFormula()">üîó ÂàÜ‰∫´ÂÖ¨Âºè</button>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let renderCount = 0;
        let lastRenderTime = 0;
        let currentTab = 'rendering';
        
        // ÂÖ¨ÂºèÊ®°Êùø
        const templates = {
            quadratic: `$$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$$`,
            matrix: `$$\\begin{pmatrix}
a & b & c \\\\
d & e & f \\\\
g & h & i
\\end{pmatrix} \\begin{pmatrix}
x \\\\ y \\\\ z
\\end{pmatrix} = \\begin{pmatrix}
ax + by + cz \\\\
dx + ey + fz \\\\
gx + hy + iz
\\end{pmatrix}$$`,
            calculus: `$$\\begin{align}
\\frac{d}{dx}[f(x)g(x)] &= f'(x)g(x) + f(x)g'(x) \\\\
\\int_{a}^{b} f(x) dx &= F(b) - F(a) \\\\
\\lim_{x \\to 0} \\frac{\\sin x}{x} &= 1
\\end{align}$$`,
            physics: `$$\\begin{align}
E &= mc^2 \\\\
F &= ma \\\\
i\\hbar\\frac{\\partial}{\\partial t}|\\psi\\rangle &= \\hat{H}|\\psi\\rangle \\\\
\\nabla \\cdot \\vec{E} &= \\frac{\\rho}{\\epsilon_0}
\\end{align}$$`,
            statistics: `$$\\begin{align}
f(x) &= \\frac{1}{\\sqrt{2\\pi\\sigma^2}} e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}} \\\\
P(A|B) &= \\frac{P(B|A)P(A)}{P(B)} \\\\
\\bar{x} &= \\frac{1}{n}\\sum_{i=1}^{n} x_i
\\end{align}$$`,
            geometry: `$$\\begin{align}
\\sin^2\\theta + \\cos^2\\theta &= 1 \\\\
e^{i\\theta} &= \\cos\\theta + i\\sin\\theta \\\\
c^2 &= a^2 + b^2 - 2ab\\cos C \\\\
A &= \\pi r^2
\\end{align}$$`
        };
        
        // ÂàùÂßãÂåñ‰∫§‰∫íÂäüËÉΩ
        function initializeInteractiveFeatures() {
            const editor = document.getElementById('math-editor');
            const previewArea = document.getElementById('preview-area');
            
            // ÂÆûÊó∂È¢ÑËßà
            editor.addEventListener('input', debounce(function() {
                updatePreview();
            }, 300));
            
            // ÂàùÂßãÊ∏≤Êüì
            setTimeout(() => {
                renderAllMath();
            }, 500);
        }
        
        // Èò≤ÊäñÂáΩÊï∞
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Êõ¥Êñ∞È¢ÑËßà
        function updatePreview() {
            const editor = document.getElementById('math-editor');
            const previewArea = document.getElementById('preview-area');
            const errorDisplay = document.getElementById('error-display');
            
            const content = editor.value.trim();
            
            if (!content) {
                previewArea.innerHTML = '<p style="color: #666; text-align: center; margin-top: 100px;">Âú®Â∑¶‰æßÁºñËæëÂô®‰∏≠ËæìÂÖ•ÂÖ¨ÂºèÔºåÈ¢ÑËßàÂ∞ÜÂú®ËøôÈáåÂÆûÊó∂ÊòæÁ§∫</p>';
                errorDisplay.style.display = 'none';
                return;
            }
            
            // Ê∏ÖÈô§‰πãÂâçÁöÑÂÜÖÂÆπ
            previewArea.innerHTML = content;
            errorDisplay.style.display = 'none';
            
            const startTime = performance.now();
            
            // Ê∏≤ÊüìÊï∞Â≠¶ÂÖ¨Âºè
            MathJax.typesetPromise([previewArea]).then(() => {
                const endTime = performance.now();
                lastRenderTime = endTime - startTime;
                renderCount++;
                
                updateStatusBar();
                
            }).catch(error => {
                console.error('MathJax Ê∏≤ÊüìÈîôËØØ:', error);
                errorDisplay.textContent = `Ê∏≤ÊüìÈîôËØØ: ${error.message}`;
                errorDisplay.style.display = 'block';
            });
        }
        
        // Êõ¥Êñ∞Áä∂ÊÄÅÊ†è
        function updateStatusBar() {
            document.getElementById('render-count').textContent = `Ê∏≤ÊüìÊ¨°Êï∞: ${renderCount}`;
            document.getElementById('last-render-time').textContent = `‰∏äÊ¨°Ê∏≤Êüì: ${lastRenderTime.toFixed(2)}ms`;
        }
        
        // ÊèíÂÖ•Á¨¶Âè∑
        function insertSymbol(symbol) {
            const editor = document.getElementById('math-editor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;
            
            editor.value = text.substring(0, start) + symbol + text.substring(end);
            editor.focus();
            editor.setSelectionRange(start + symbol.length, start + symbol.length);
            
            updatePreview();
        }
        
        // Ê∏ÖÈô§ÁºñËæëÂô®
        function clearEditor() {
            document.getElementById('math-editor').value = '';
            updatePreview();
        }
        
        // Ê†ºÂºèÂåñ‰ª£Á†Å
        function formatCode() {
            const editor = document.getElementById('math-editor');
            let content = editor.value;
            
            // ÁÆÄÂçïÁöÑÊ†ºÂºèÂåñËßÑÂàô
            content = content.replace(/\\\\\\\\/g, '\\\\\\n');
            content = content.replace(/\\begin\{align\}/g, '\\n\\\\begin{align}\\n');
            content = content.replace(/\\end\{align\}/g, '\\n\\\\end{align}\\n');
            content = content.replace(/&=/g, ' &= ');
            
            editor.value = content;
            updatePreview();
        }
        
        // È™åËØÅËØ≠Ê≥ï
        function validateSyntax() {
            const editor = document.getElementById('math-editor');
            const content = editor.value;
            
            // ÁÆÄÂçïÁöÑËØ≠Ê≥ïÊ£ÄÊü•
            const errors = [];
            
            // Ê£ÄÊü•Êã¨Âè∑ÂåπÈÖç
            const brackets = { '{': '}', '[': ']', '(': ')' };
            const stack = [];
            
            for (let i = 0; i < content.length; i++) {
                const char = content[i];
                if (brackets[char]) {
                    stack.push(char);
                } else if (Object.values(brackets).includes(char)) {
                    const last = stack.pop();
                    if (!last || brackets[last] !== char) {
                        errors.push(`Á¨¨ ${i + 1} ‰Ωç: Êã¨Âè∑‰∏çÂåπÈÖç`);
                    }
                }
            }
            
            if (stack.length > 0) {
                errors.push('Â≠òÂú®Êú™Èó≠ÂêàÁöÑÊã¨Âè∑');
            }
            
            // ÊòæÁ§∫ÁªìÊûú
            const errorDisplay = document.getElementById('error-display');
            if (errors.length > 0) {
                errorDisplay.textContent = 'ËØ≠Ê≥ïÈîôËØØ: ' + errors.join(', ');
                errorDisplay.style.display = 'block';
            } else {
                errorDisplay.textContent = '‚úÖ ËØ≠Ê≥ïÊ£ÄÊü•ÈÄöËøá';
                errorDisplay.style.display = 'block';
                errorDisplay.style.background = '#f0fff4';
                errorDisplay.style.color = '#22543d';
                errorDisplay.style.borderColor = '#9ae6b4';
                
                setTimeout(() => {
                    errorDisplay.style.display = 'none';
                    errorDisplay.style.background = '#fff5f5';
                    errorDisplay.style.color = '#c53030';
                    errorDisplay.style.borderColor = '#fed7d7';
                }, 3000);
            }
        }
        
        // Âä†ËΩΩÊ®°Êùø
        function loadTemplate(templateName) {
            const editor = document.getElementById('math-editor');
            editor.value = templates[templateName] || '';
            updatePreview();
        }
        
        // ÂàáÊç¢Ê†áÁ≠æÈ°µ
        function switchTab(tabName) {
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            // Êõ¥Êñ∞ÂÜÖÂÆπÊòæÁ§∫
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            currentTab = tabName;
        }
        
        // ÊµãËØïÂáΩÊï∞
        function testBasicRendering() {
            const output = document.getElementById('basic-render');
            output.innerHTML = '$$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$';
            MathJax.typesetPromise([output]);
        }
        
        function testComplexFormulas() {
            const output = document.getElementById('complex-render');
            output.innerHTML = `$$\\begin{pmatrix}
\\cos\\theta & -\\sin\\theta \\\\
\\sin\\theta & \\cos\\theta
\\end{pmatrix} \\begin{pmatrix}
x \\\\ y
\\end{pmatrix} = \\begin{pmatrix}
x\\cos\\theta - y\\sin\\theta \\\\
x\\sin\\theta + y\\cos\\theta
\\end{pmatrix}$$`;
            MathJax.typesetPromise([output]);
        }
        
        function testDynamicUpdate() {
            const output = document.getElementById('dynamic-render');
            let counter = 1;
            
            const interval = setInterval(() => {
                counter++;
                output.innerHTML = `$$x = ${counter}$$`;
                MathJax.typesetPromise([output]);
                
                if (counter >= 10) {
                    clearInterval(interval);
                }
            }, 500);
        }
        
        function testChemistry() {
            const output = document.getElementById('chemistry-test');
            output.innerHTML = '$$\\ce{2H2 + O2 -> 2H2O}$$';
            MathJax.typesetPromise([output]);
        }
        
        function testPhysics() {
            const output = document.getElementById('physics-test');
            output.innerHTML = '$$\\braket{\\psi}{\\phi} = \\int_{-\\infty}^{\\infty} \\psi^*(x) \\phi(x) dx$$';
            MathJax.typesetPromise([output]);
        }
        
        function testColors() {
            const output = document.getElementById('color-test');
            output.innerHTML = '$$\\color{red}{a}x^2 + \\color{blue}{b}x + \\color{green}{c} = 0$$';
            MathJax.typesetPromise([output]);
        }
        
        function testRenderingSpeed() {
            const result = document.getElementById('speed-result');
            const formulas = [];
            
            // ÁîüÊàê100‰∏™ÂÖ¨Âºè
            for (let i = 0; i < 100; i++) {
                formulas.push(`$$x_{${i}} = \\frac{${i}}{${i + 1}}$$`);
            }
            
            const testDiv = document.createElement('div');
            testDiv.innerHTML = formulas.join('');
            document.body.appendChild(testDiv);
            
            const startTime = performance.now();
            
            MathJax.typesetPromise([testDiv]).then(() => {
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                result.innerHTML = `Ê∏≤Êüì100‰∏™ÂÖ¨ÂºèÁî®Êó∂: ${duration.toFixed(2)}ms<br>Âπ≥Âùá: ${(duration / 100).toFixed(2)}ms/ÂÖ¨Âºè`;
                
                document.body.removeChild(testDiv);
            });
        }
        
        function testMemoryUsage() {
            const result = document.getElementById('memory-result');
            
            if (performance.memory) {
                const before = performance.memory.usedJSHeapSize;
                
                // ÂàõÂª∫Â§ßÈáèÊï∞Â≠¶ÂÖ¨Âºè
                const testDiv = document.createElement('div');
                const formulas = [];
                
                for (let i = 0; i < 500; i++) {
                    formulas.push(`$$\\sum_{n=1}^{${i + 1}} \\frac{1}{n^2} = \\frac{\\pi^2}{6}$$`);
                }
                
                testDiv.innerHTML = formulas.join('');
                document.body.appendChild(testDiv);
                
                MathJax.typesetPromise([testDiv]).then(() => {
                    const after = performance.memory.usedJSHeapSize;
                    const increase = (after - before) / 1024 / 1024;
                    
                    result.innerHTML = `Ê∏≤Êüì500‰∏™ÂÖ¨ÂºèÂÜÖÂ≠òÂ¢ûÂä†: ${increase.toFixed(2)}MB<br>Âπ≥Âùá: ${(increase / 500 * 1024).toFixed(2)}KB/ÂÖ¨Âºè`;
                    
                    document.body.removeChild(testDiv);
                });
            } else {
                result.innerHTML = 'ÊµèËßàÂô®‰∏çÊîØÊåÅÂÜÖÂ≠òÁõëÊéß';
            }
        }
        
        function testAccessibility() {
            const output = document.getElementById('accessibility-test');
            output.innerHTML = '$$\\frac{\\sqrt{a^2 + b^2}}{c + d}$$';
            
            MathJax.typesetPromise([output]).then(() => {
                // Ê£ÄÊü•ÊòØÂê¶ÁîüÊàê‰∫ÜÂèØËÆøÈóÆÊÄßÂ±ûÊÄß
                const mathElements = output.querySelectorAll('[role="math"]');
                if (mathElements.length > 0) {
                    console.log('‚úÖ ÂèØËÆøÈóÆÊÄßÊîØÊåÅÊ≠£Â∏∏');
                } else {
                    console.log('‚ùå ÂèØËÆøÈóÆÊÄßÊîØÊåÅÂºÇÂ∏∏');
                }
            });
        }
        
        function testKeyboardNavigation() {
            const result = document.getElementById('keyboard-result');
            result.innerHTML = 'ËØ∑‰ΩøÁî®TabÈîÆÂØºËà™‰∏ãÈù¢ÁöÑÂÖ¨Âºè: $$\\int_0^1 x^2 dx = \\frac{1}{3}$$';
            
            MathJax.typesetPromise([result]);
        }
        
        // ÂØºÂá∫‰ª£Á†Å
        function exportCode() {
            const editor = document.getElementById('math-editor');
            const content = editor.value;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `math-formula-${Date.now()}.tex`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
        }
        
        // ÂàÜ‰∫´ÂÖ¨Âºè
        function shareFormula() {
            const editor = document.getElementById('math-editor');
            const content = editor.value;
            
            if (navigator.share) {
                navigator.share({
                    title: 'MathJax ÂÖ¨Âºè',
                    text: content
                });
            } else {
                // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
                navigator.clipboard.writeText(content).then(() => {
                    alert('ÂÖ¨ÂºèÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                });
            }
        }
        
        // Ê∏≤ÊüìÊâÄÊúâÊï∞Â≠¶ÂÖ¨Âºè
        function renderAllMath() {
            MathJax.typesetPromise().then(() => {
                console.log('ÊâÄÊúâÊï∞Â≠¶ÂÖ¨ÂºèÊ∏≤ÊüìÂÆåÊàê');
                document.getElementById('mathjax-status').style.background = '#27ae60';
            });
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('MathJax ‰∫§‰∫íÂºèÊµãËØïÂπ≥Âè∞Âä†ËΩΩÂÆåÊàê');
        });
    </script>
</body>
</html>